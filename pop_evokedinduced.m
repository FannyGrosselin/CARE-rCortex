% pop_evokedinduced() - function which displays a graphical user interface 
%                       allowing to apply time-frequency transforms to
%                       the raw EEG data channels in order to highlight
%                       evoked or induced activities as it is discribed
%                       in Catherine Tallon-Baudry paper (1999). 
%
% Author: Fanny Grosselin, 2018
%
% Usage:
%   >> com = pop_evokedinduced( EEG );
%
% Graphic interface:
%   PARAMETERS
%   ==========
%   "Enter the lower frequency in the decompsition (in Hz)" - [edit box]
%           Enter the lower frequency (>=2 and smaller than higher frequency)
%           for the calcul of time-frequency maps.
%   "Enter the higher frequency in the decompsition (in Hz)" - [edit box] 
%           Enter the higher frequency (higher than lower frequency 
%           and < half of sampling frequency) for the calcul of time-frequency maps.
%   "Resolution (in Hz) between 0.25 and 2 Hz" - [edit box] 
%           Enter the resolution frequency for the calcul of time-frequency maps.
%   "Load other default parameters" - [pushbutton] Press this button if you want 
%           to load default parameters.
%   "Baseline" - [checkbox] Check it if you want to display normalization
%           with baseline.
% ---------------------------------------------------
%   BASELINE
%   ========
%   "CHOOSE AN AUTOMATIC BASELINE" - [checkbox] Tick it if you want to
%           choose a baseline automatically according to flow or pressure cycles. 
%   "Pressure" - [checkbox] Tick it if you want to choose baseline
%           according to pressure channel. (It's for automatic baseline).
%   "Flow" - [checkbox] Tick it if you want to choose baseline
%           according to flow channel. (It's for automatic baseline).
%   "Cardiac" - [checkbox] Tick it if you want to choose baseline
%           according to cardiac channel. (It's for automatic baseline).
%   "Start of inspiration" - [checkbox] Tick it if you want the baseline
%           is located according to the start of inspiration. (It's for automatic baseline).
%   "Maximum of flow/pressure" - [checkbox] Tick it if you want the baseline
%           is located according to the maximum of flow or pressure signal.
%           (It's for automatic baseline).
%   "Start of expiration" - [checkbox] Tick it if you want the baseline
%           is located according to the start of expiration. (It's for automatic baseline).
%   "Minimum of flow/pressure" - [checkbox] Tick it if you want the baseline
%           is located according to the minimum of flow or pressure signal.
%           (It's for automatic baseline).
%   "Before markers" - [checkbox] Tick it if you want the baseline is located on
%           the left of markers chosen (start of inspiration, start of
%           exhalation, etc.). (It's for automatic baseline).
%   "After markers" - [checkbox] Tick it if you want the baseline is located on
%           the right of markers chosen (start of inspiration, start of
%           exhalation, etc.). (It's for automatic baseline).
%   "Length of baseline (in ms)" - [edit box] Enter the baseline length in ms.
%           (It's for automatic baseline).
%   "Stability of markers differences" - [histograph] Graph showing
%           repartition of differences between two successive markers (start of
%           inspiration, start of exhalation, etc.). The higher the porcentage
%           of differences between markers corresponding to the length of
%           an epoch (EEG.pnts), the better the marker chosen to choose
%           the baseline will be. To interpret this histograph, average and
%           standard deviation are shown. To have a good marker, the
%           average must be closed to the length of an epoch (EEG.pnts) and 
%           the standard deviation must be close to 0. (It's for automatic baseline).
%   "Check baselines" - [pushbutton] Push this button to check baseline
%           locations on the pressure or flow signal. On the figure which
%           appears, you can remove or add baseline(s). (It's for automatic baseline).
%   "CHOOSE A MANUAL BASELINE" - [checkbox] Tick it if you want to choose a
%           manual baseline without taking flow or pressure cycles into
%           account.
%   "Baseline limits (in ms) : min max" - [edit box] Enter in ms the start
%           and the end of the baseline you want to normalize data. (It's for 
%           manual baseline).
%   "Show significant point with respect to the baseline" - [checkbox] Push
%           this button to show the significant points of the
%           time-frequency map based on the significance level, described later.
%           This will only work with the time-frequency computation
%           "Plot induced potentials (average of time-frequency
%           maps)". It will compute the significant mask based on baseline 
%           permutation, described in Grandchamp and Delorme, Frontiers in 
%           Pyscology (Sept 2011). Here we used 500 baseline permutations for 
%           each frequency bin. 
%           The surrogate time-frequency map with randome baseline is compared 
%           to the time-frequency map, normalized with a z-score baseline 
%           correction.
%           The obtained mask can be multiplied on the original
%           time-frequency map normalized by the chosen type baseline. 
%   "Significant level" - [edit box] Enter the significance level to
%           compute two-tailed permutation significance probability level. 
%   "Use Z-score baseline" - [muliple choice list] there are four types of
%              baseline correction, Z-score (the mean value of baseline is substracted
%			   and the standard deviation of baseline is divided), absolute
%			  (the mean value of baseline is subtracted), relative (the data is 
%              divided by the mean value of baseline) or dB (the relative data not 
%			  in percentage are transformed in decibel by a 10*log10 operation). 
%			  The choice is yours.
% ---------------------------------------------------
%   PLOT
%   ====
%   "Select channel(s) to plot" - [listbox] Choose channel(s) you want to
%           display.
%   "Plot evoked potentials (time-frequency map of epochs average)" - [checkbox] 
%           Check it if you want to display calcul of time-frequency map
%            for evoked activities (timefrequencyevoked(), timefrequencyevokedBase()).
%   "Plot induced potentials (average of time-frequency maps)" - [checkbox] 
%           Check it if you want to display calcul of time-frequency map for 
%           induced activities (timefrequencyinduced(), timefrequencyinducedBase()).
%   "Yes/No" - [radiobutton] Choose if you want to overlay the cone of influence on map(s)
%           ("significant" and "non significant" data). 
%   "Select a channel to monitor baseline location" - [checkbox and listbox] Check it
%           if you want to be allowed to choice a channel to control 
%           baseline location on the average of epochs of this channel.
%   "Automatic range (min and max of time-frequency map)" - [checkbox] Tick
%           it of you want to spread the colorbar between minimum value of
%           the time-frequency map.
%   "Manual range" - [checkbox] Tick it if you want to choose colorbar
%           value manually. You have to fill out "min" and "max" edit boxes.
%   "min" - [edit box] Enter the value you want to take for the minimum of colorbar.
%   "max" - [edit box] Enter the value you want to take for the maximum of colorbar.
% ----------------------------------------------------
%   "Help" - [pushbutton] Press it if you need help about how run
%           pop_evokedinduced().
%   "Cancel" - [pushbutton] Press it if you want to cancel the analysis.
%   "OK" - [pushbutton] Press it to display the analysis with
%           time-frequency map(s).
%
% Input:
%   EEG - EEGLAB EEG structure
%
% Outputs from pop-up:
%   com       - history string
%   Plot(s) containing a time-frequency map, a scalp map showing channel location 
%   and optionally a plot of mean of channel epochs with baseline location.
%   If you have selected "Yes" to display significant line on map, there is
%   a line on time-frequency map separating significant data and non
%   significant data.
%   The interface also save latest frequency parameters used in a file
%   called latest_parameters.txt and also save latest baseline parameters
%   used in a file called latest_automatic_bseline.txt (if we used an automatic
%   detection of baseline) or a file called latest_manual_baseline.txt (if we
%   used a manual detection of baseline). When user opens interface, the
%   function load these latest parameters of frequency and baseline in the
%   graphical user interface. 
%
% See also:
%   pop_param_Callback(), timefrequencyevoked(), timefrequencyinduced(),
%   timefrequencyevokedBase(), timefrequecyinducedBase(),
%   evokedinducedtopoplot(), baseline_significance().

function com = pop_evokedinduced(EEG)

clear indice_chan choice_respiratory answer a range_colorbar histo_graph event_assoc_minb event_assoc_maxb significant_line listauxbase mark marker_baseline latency listaux unit Tmin resulparamclbk evo indu lfreqnorm hfreqnorm resolnorm listchannel EEGnbchan EEGtrials EEGdata i nfft EEGtimes EEGchanlocslabels EEGchanlocs EEGsrate EEGchaninfo minb maxb MINB MAXB len_base BASELINE;

% display help if not enough arguments
% ------------------------------------
if nargin < 1
	help pop_evokedinduced;
	return;
	
else
    com= '';
    if isempty(EEG.chanlocs) || ~isfield(EEG.chanlocs, 'theta') || all(cellfun('isempty', { EEG.chanlocs.theta }))
        errordlg2( char('This functionality requires channel location information.',...
            'Enter the channel file name via "Edit > Channel locations".',...
            'For channel file format, see ">> help readlocs" from the command line.'), 'Error');
    elseif isempty(EEG.epoch)
        errordlg2('You must extract epochs before identifying evoked or induced activities');
        return;
    elseif isempty(EEG.filepath)
        errordlg2('You must save dataset before analyse data.');
        return;
    else
        %% list of channels
        %  ----------------
        show_options = {' '};
		show_options{end+1} = ['All channels'];
        for index = 1:EEG.nbchan
            show_options{end+1} = [ EEG.chanlocs(index).labels ];
        end;
        
        %% list of auxiliary channels
        %  --------------------------
        show_aux = {};
        for index = 1:EEG.nbchan
            show_aux{end+1} = [ EEG.chanlocs(index).labels ];
        end;
        
		%% list of baseline options
		%  ------------------------
		show_options_baseline = {'Use Z-score baseline','Use absolute baseline','Use relative baseline','Use dB baseline'};
		
        %% parameters
        %  ----------
        if exist('latest_parameters.txt','file') % read latest parameters in text file if exists
            fid = fopen('latest_parameters.txt','r');
            [resulparamclbk.keyparam(1),resulparamclbk.valparam(1),...
                resulparamclbk.keyparam(2),resulparamclbk.valparam(2),...
                resulparamclbk.keyparam(3),resulparamclbk.valparam(3)] = strread(fgets(fid), '%s %f %s %f %s %f');
            lower_freq = resulparamclbk.valparam(1);
            higher_freq = resulparamclbk.valparam(2);
            resolution = resulparamclbk.valparam(3);
            fclose(fid);
            clear fid ans;
        else
            lower_freq = '2';
            higher_freq = '30';
            resolution = '0.25';
        end;
            
	    %% Callbacks
        %  ---------
        param_Callback = 'resulparamclbk = pop_param_Callback();';
        
        clbk_showSignif = [...
            'showSignif = get(findobj(''parent'',gcbf,''tag'',''showSignif''),''value'');'...
            'text_signif_level = findobj(''parent'',gcbf,''tag'',''text_signif_level'');'...
            'signif_level = findobj(''parent'',gcbf,''tag'',''signif_level'');'...
            ...
            'if showSignif == 0'... 
                '    set(text_signif_level,''enable'',''off'');'...
                '    set(signif_level,''enable'',''off'');'...
                '    set(signif_level,''string'',''0.05'');'...
            'else'...
                '    set(text_signif_level,''enable'',''on'');'...
                '    set(signif_level,''enable'',''on'');'...
                '    set(signif_level,''string'',''0.05'');'...
            'end;'...
            'clear showSignif text_signif_level signif_level;'
            ];...

        clbk_baseline = [...
            'state_baseline = get(findobj(''parent'', gcbf, ''tag'', ''baseline''),''value'');'...
            'automatic_baseline = findobj(''parent'', gcbf, ''tag'', ''automatic_baseline'');'...
            'manual_baseline = findobj(''parent'', gcbf, ''tag'', ''manual_baseline'');'...
            'text_baseline_limits = findobj(''parent'', gcbf, ''tag'', ''text_baseline_limits'');'...
            'baseline_limits = findobj(''parent'', gcbf, ''tag'', ''baseline_limits'');'...
            '    if exist(''latest_manual_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                '    fid = fopen(''latest_manual_baseline.txt'',''r'');'...
                '    [title,valmin,valmax] = strread(fgets(fid), ''%s %f %f'');'... % Go to the second line
                '    val = [num2str(valmin) '' '' num2str(valmax)];'...
                '    set(baseline_limits,''string'',val);'...
                '    fclose(fid);'...
                '    clear fid ans title val valmin valmax;'...
            '    else'...
				'    val = [num2str(EEG.xmin*1000) '' '' num2str(0)];'...
                '    set(baseline_limits,''string'',val);'...
            '    end;'...
            'text_aux = findobj(''parent'', gcbf, ''tag'', ''text_aux'');'...
            'pression_base = findobj(''parent'', gcbf, ''tag'', ''pression_base'');'...
            'flow_base = findobj(''parent'', gcbf, ''tag'', ''flow_base'');'...
			'cardiac_base = findobj(''parent'', gcbf, ''tag'', ''cardiac_base'');'...
            'where = findobj(''parent'', gcbf, ''tag'', ''where'');'...
            'beginspi = findobj(''parent'', gcbf, ''tag'', ''beginspi'');'...
            'begexpi = findobj(''parent'', gcbf, ''tag'', ''begexpi'');'...
            'peakmax = findobj(''parent'', gcbf, ''tag'', ''peakmax'');'...  
            'peakmin = findobj(''parent'', gcbf, ''tag'', ''peakmin'');'... 
            'text_latency = findobj(''parent'', gcbf, ''tag'', ''text_latency'');'...
            'latpos = findobj(''parent'', gcbf, ''tag'', ''latpos'');'...
            'latneg = findobj(''parent'', gcbf, ''tag'', ''latneg'');'...            
            'text_len_base = findobj(''parent'', gcbf, ''tag'', ''text_len_base'');'...
            'len_base = findobj(''parent'', gcbf, ''tag'', ''len_base'');'...
            'button_baseline = findobj(''parent'', gcbf, ''tag'', ''button_baseline'');'...
            'tit_hist = findobj(''parent'', gcbf, ''tag'', ''tit_hist'');'...
            'txt_mean_hist = findobj(''parent'', gcbf, ''tag'', ''txt_mean_hist'');'...
            'mean_hist = findobj(''parent'', gcbf, ''tag'', ''mean_hist'');'...
            'txt_std_hist = findobj(''parent'', gcbf, ''tag'', ''txt_std_hist'');'...
            'std_hist = findobj(''parent'', gcbf, ''tag'', ''std_hist'');'...
            'select_aux = findobj(''parent'',gcbf,''tag'',''select_aux'');'...
            'showSignif = findobj(''parent'',gcbf,''tag'',''showSignif'');'...
            'text_signif_level = findobj(''parent'',gcbf,''tag'',''text_signif_level'');'...
            'signif_level = findobj(''parent'',gcbf,''tag'',''signif_level'');'...
			'optbaseline = findobj(''parent'',gcbf,''tag'',''optbaseline'');'...
            ...
            'if state_baseline == 0'... 
                '    set(showSignif,''enable'',''off'');'...
                '    set(showSignif,''value'',0);'...
                '    set(text_signif_level,''enable'',''off'');'...
                '    set(signif_level,''enable'',''off'');'...
                '    set(signif_level,''string'',''0.05'');'...
				'    set(optbaseline,''enable'',''off'');'...
                '    set(automatic_baseline,''value'',0);'...
                '    set(automatic_baseline,''enable'',''off'');'...
                '    set(manual_baseline,''value'',0);'...
                '    set(manual_baseline,''enable'','' off'');'... 
                '    set(text_baseline_limits,''enable'','' off'');'... 
                '    set(baseline_limits,''enable'','' off'');'... 
                '    if exist(''latest_manual_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                    '    fid = fopen(''latest_manual_baseline.txt'',''r'');'...
                    '    [title,valmin,valmax] = strread(fgets(fid), ''%s %f %f'');'... % Go to the second line
                    '    val = [num2str(valmin) '' '' num2str(valmax)];'...
                    '    set(baseline_limits,''string'',val);'...
                    '    fclose(fid);'...
                    '    clear fid ans title val valmin valmax;'...
                '    else'...
                    '    val = [num2str(EEG.xmin*1000) '' '' num2str(0)];'...
					'    set(baseline_limits,''string'',val);'...
                '    end;'...
                '    set(text_aux,''enable'',''off'');'...
                '    set(pression_base,''enable'',''off'');'...
                '    set(pression_base,''value'',0);'...
                '    set(flow_base,''enable'',''off'');'...
                '    set(flow_base,''value'',0);'...
				'    set(cardiac_base,''enable'',''off'');'...
                '    set(cardiac_base,''value'',0);'...
                '    set(where,''enable'','' off'');'...                
                '    set(beginspi,''enable'',''off'');'...
                '    set(beginspi,''value'',0);'...
                '    set(begexpi,''enable'',''off'');'...
                '    set(begexpi,''value'',0);'...
                '    set(peakmax,''enable'',''off'');'...
                '    set(peakmax,''value'',0);'...
                '    set(peakmin,''enable'',''off'');'...
                '    set(peakmin,''value'',0);'...
                '    set(text_latency,''enable'',''off'');'...
                '    set(latpos,''enable'',''off'');'...
                '    set(latpos,''value'',0);'...
                '    set(latneg,''enable'',''off'');'...
                '    set(latneg,''value'',0);'...
                '    set(text_len_base,''enable'',''off'');'...
                '    set(len_base,''enable'',''off'');'...
                '    set(len_base,''string'','' '');'...
                '    set(button_baseline,''enable'',''off'');'...
                '    set(tit_hist,''enable'',''off'');'...
                '    set(txt_mean_hist,''enable'',''off'');'...
                '    set(mean_hist,''enable'',''off'');'...
                '    set(txt_std_hist,''enable'',''off'');'...
                '    set(std_hist,''enable'',''off'');'...
                '    set(mean_hist,''visible'',''off'');'...
                '    set(std_hist,''visible'',''off'');'...
                '    set(select_aux,''enable'',''off'');'...
                ...
                ... % Deletion ACCEPTBASELINE and histogram
                ... % -------------------------------------
                '    if exist(''ACCEPTBASELINE'')'...
                    '    clear ACCEPTBASELINE;'...
                '    end;'...
                '    if exist(''histo_graph'')'...
                    '    try'...
                        '    delete(histo_graph);'...
                        '    clear(''histo_graph'');'...
                    '    catch'...
                        '    clear(''histo_graph'');'...
                    '    end;'...
                '    end;'...
                'clear len;'...
                ...
            'else'...
				'    progressbar(''Preparing the histograph...'');'...
				'    disp(''Activation of the baseline part.'');'...
                '    set(showSignif,''enable'',''on'');'...
                '    set(showSignif,''value'',0);'...
                '    set(text_signif_level,''enable'',''off'');'...
                '    set(signif_level,''enable'',''off'');'...
                '    set(signif_level,''string'',''0.05'');'...
				'    set(optbaseline,''enable'',''on'');'...
                ... % Tests if channel labels of pression and/or flow and/or cardiac exist
                '    ok = [];'...
                '    aux_raw_p = [];'...
                '    aux_raw_f = [];'...
				'    aux_raw_c = [];'...
                '    indice_chan = 0;'...
				'	 disp(''Checking if pression respiratory signal exist in your data...'');'...
                '    for a = 1:EEG.nbchan'...
                    '    if strcmp(''Pression'',EEG.chanlocs(a).labels) || strcmp(''pression'',EEG.chanlocs(a).labels) || strcmp(''PRESSION'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''Pressure'',EEG.chanlocs(a).labels) || strcmp(''pressure'',EEG.chanlocs(a).labels) || strcmp(''PRESSURE'',EEG.chanlocs(a).labels)'...
                        '    set(pression_base,''enable'',''on'');'...
                        '    ok = [ok 1];'...
                        '    indice_chan = a;'...
                    '    end;'...
					'    progressbar(a/EEG.nbchan*0.1);'...
                '    end;'...
				'	 disp(''Done.'');'...
                '    if indice_chan ~= 0'...
                    '    for b = 1:EEG.trials'... % Construction of pression data epoch on a raw
                        '    aux_raw_p = [aux_raw_p, double(EEG.data(indice_chan,:,b))];'...
						'    progressbar(0.1+b/EEG.trials*0.14);'...
                    '    end;'...
                '    end;'...
				'    progressbar(0.25);'...
				'	 disp(''Checking if flow respiratory signal exist in your data...'');'...
                '    for a = 1:EEG.nbchan'...
                    '    if strcmp(''Debit'',EEG.chanlocs(a).labels) || strcmp(''debit'',EEG.chanlocs(a).labels) || strcmp(''D?bit'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''d?bit'',EEG.chanlocs(a).labels) || strcmp(''DEBIT'',EEG.chanlocs(a).labels) || strcmp(''Flow'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''flow'',EEG.chanlocs(a).labels) || strcmp(''FLOW'',EEG.chanlocs(a).labels) || strcmp(''Débit'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''débit'',EEG.chanlocs(a).labels) || strcmp(''dÃ©bit'',EEG.chanlocs(a).labels) || strcmp(''DÃ©bit'',EEG.chanlocs(a).labels)'...
                        '    set(flow_base,''enable'',''on'');'...
                        '    ok = [ok 2];'...
                        '    indice_chan = a;'...
                    '    end;'...
					'    progressbar(0.25+a/EEG.nbchan*0.1);'...
                '    end;'...
				'    disp(''Done.'');'...
                '    if indice_chan ~= 0'...
                    '    for b = 1:EEG.trials'... % Construction of flow data epoch on a raw
                        '    aux_raw_f = [aux_raw_f, double(EEG.data(indice_chan,:,b))];'...
						'    progressbar(0.35+b/EEG.trials*0.14);'...
                    '    end;'...
                '    end;'...
				'    progressbar(0.5);'...
				'	 disp(''Checking if cardiac signal exist in your data...'');'...
				'    for a = 1:EEG.nbchan'...
                    '    if strcmp(''CARDIAC'',EEG.chanlocs(a).labels) || strcmp(''Cardiac'',EEG.chanlocs(a).labels) || strcmp(''cardiac'',EEG.chanlocs(a).labels) ||' ...
							'strcmp(''COEUR'',EEG.chanlocs(a).labels) || strcmp(''Coeur'',EEG.chanlocs(a).labels) || strcmp(''coeur'',EEG.chanlocs(a).labels) ||' ...
							'strcmp(''ECG'',EEG.chanlocs(a).labels) || strcmp(''Ecg'',EEG.chanlocs(a).labels) || strcmp(''ecg'',EEG.chanlocs(a).labels) ||' ...
							'strcmp(''CARDIAQUE'',EEG.chanlocs(a).labels) || strcmp(''Cardiaque'',EEG.chanlocs(a).labels) || strcmp(''cardiaque'',EEG.chanlocs(a).labels)'...
                        '    set(cardiac_base,''enable'',''on'');'...
                        '    ok = [ok 3];'...
                        '    indice_chan = a;'...
                    '    end;'...
					'    progressbar(0.5+a/EEG.nbchan*0.1);'...
                '    end;'...
				'    disp(''Done.'');'...
                '    if indice_chan ~= 0'...
                    '    for b = 1:EEG.trials'... % Construction of cardiac data epoch on a raw
                        '    aux_raw_c = [aux_raw_c, double(EEG.data(indice_chan,:,b))];'...
						'    progressbar(0.6+b/EEG.trials*0.14);'...
                    '    end;'...
                '    end;'...
				'    progressbar(0.75);'...
				'    if ~isempty(aux_raw_p) || ~isempty(aux_raw_f) || ~isempty(aux_raw_c)'...
					'    if ~isempty(aux_raw_p)'...
						'    set(automatic_baseline,''value'',1);'...
						'    set(manual_baseline,''value'',0);'...
						'    set(automatic_baseline,''enable'',''on'');'...
						'    set(manual_baseline,''enable'',''on'');'...
						'    set(text_baseline_limits,''enable'','' off'');'... 
						'    set(baseline_limits,''enable'','' off'');'... 
                        '    if exist(''latest_manual_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                            '    fid = fopen(''latest_manual_baseline.txt'',''r'');'...
                            '    [title,valmin,valmax] = strread(fgets(fid), ''%s %f %f'');'... % Go to the second line
                            '    val = [num2str(valmin) '' '' num2str(valmax)];'...
                            '    set(baseline_limits,''string'',val);'...
                            '    fclose(fid);'...
                            '    clear fid ans title val valmin valmax;'...
                        '    else'...
                            '    val = [num2str(EEG.xmin*1000) '' '' num2str(0)];'...
							'    set(baseline_limits,''string'',val);'...
                        '    end;'...
						'    set(pression_base,''value'',1);'...
						'    set(flow_base,''value'',0);'...
						'    set(cardiac_base,''value'',0);'...
						'    aux_raw = aux_raw_p;'...
						'    set(where,''enable'',''on'');'...                
						'    set(beginspi,''enable'',''on'');'...
						'    set(beginspi,''value'',1);'...
						'    set(begexpi,''enable'',''on'');'...
						'    set(begexpi,''value'',0);'...
						'    set(peakmax,''enable'',''on'');'...
						'    set(peakmax,''value'',0);'...
						'    set(peakmin,''enable'',''on'');'...
						'    set(peakmin,''value'',0);'...
						'    ok_ch = 1;'...
					'    elseif isempty(aux_raw_p) && ~isempty(aux_raw_f)'...
						'    set(automatic_baseline,''value'',1);'...
						'    set(manual_baseline,''value'',0);'...
						'    set(automatic_baseline,''enable'',''on'');'...
						'    set(manual_baseline,''enable'',''on'');'...
						'    set(text_baseline_limits,''enable'','' off'');'... 
						'    set(baseline_limits,''enable'','' off'');'... 
                        '    if exist(''latest_manual_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                            '    fid = fopen(''latest_manual_baseline.txt'',''r'');'...
                            '    [title,valmin,valmax] = strread(fgets(fid), ''%s %f %f'');'... % Go to the second line
                            '    val = [num2str(valmin) '' '' num2str(valmax)];'...
                            '    set(baseline_limits,''string'',val);'...
                            '    fclose(fid);'...
                            '    clear fid ans title val valmin valmax;'...
                        '    else'...
                            '    val = [num2str(EEG.xmin*1000) '' '' num2str(0)];'...
							'    set(baseline_limits,''string'',val);'...
                        '    end;'...
						'    set(pression_base,''value'',0);'...
						'    set(flow_base,''value'',1);'...
						'    set(cardiac_base,''value'',0);'...
						'    aux_raw = aux_raw_f;'...
						'    set(where,''enable'',''on'');'...                
						'    set(beginspi,''enable'',''on'');'...
						'    set(beginspi,''value'',1);'...
						'    set(begexpi,''enable'',''on'');'...
						'    set(begexpi,''value'',0);'...
						'    set(peakmax,''enable'',''on'');'...
						'    set(peakmax,''value'',0);'...
						'    set(peakmin,''enable'',''on'');'...
						'    set(peakmin,''value'',0);'...
						'    ok_ch = 2;'...
					'    elseif isempty(aux_raw_p) && isempty(aux_raw_f) && ~isempty(aux_raw_c)'...
						'    set(automatic_baseline,''value'',1);'...
						'    set(manual_baseline,''value'',0);'...
						'    set(automatic_baseline,''enable'',''on'');'...
						'    set(manual_baseline,''enable'',''on'');'...
						'    set(text_baseline_limits,''enable'','' off'');'... 
						'    set(baseline_limits,''enable'','' off'');'... 
                        '    if exist(''latest_manual_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                            '    fid = fopen(''latest_manual_baseline.txt'',''r'');'...
                            '    [title,valmin,valmax] = strread(fgets(fid), ''%s %f %f'');'... % Go to the second line
                            '    val = [num2str(valmin) '' '' num2str(valmax)];'...
                            '    set(baseline_limits,''string'',val);'...
                            '    fclose(fid);'...
                            '    clear fid ans title val valmin valmax;'...
                        '    else'...
                            '    val = [num2str(EEG.xmin*1000) '' '' num2str(0)];'...
							'    set(baseline_limits,''string'',val);'...
                        '    end;'...
						'    set(pression_base,''value'',0);'...
						'    set(flow_base,''value'',0);'...
						'    set(cardiac_base,''value'',1);'...
						'    aux_raw = aux_raw_c;'...
						'    set(where,''enable'',''off'');'...                
						'    set(beginspi,''enable'',''off'');'...
						'    set(beginspi,''value'',0);'...
						'    set(begexpi,''enable'',''off'');'...
						'    set(begexpi,''value'',0);'...
						'    set(peakmax,''enable'',''off'');'...
						'    set(peakmax,''value'',0);'...
						'    set(peakmin,''enable'',''off'');'...
						'    set(peakmin,''value'',0);'...
						'    ok_ch = 3;'...
					'    end;'...
					'    progressbar(0.9);'...
                    '    set(text_aux,''enable'',''on'');'... 
                    '    set(text_latency,''enable'',''on'');'...
                    '    set(latpos,''enable'',''on'');'...
                    '    set(latpos,''value'',0);'...
                    '    set(latneg,''enable'',''on'');'...
                    '    set(latneg,''value'',1);'...
                    '    set(text_len_base,''enable'',''on'');'...
                    '    set(len_base,''enable'',''on'');'...
                    '    set(button_baseline,''enable'',''on'');'...
                    '    if exist(''latest_automatic_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                        '    fid = fopen(''latest_automatic_baseline.txt'',''r'');'...
                        '    [title,len] = strread(fgets(fid), ''%s %f'');'... % Go to the second line
                        '    set(len_base,''string'',len);'...
                        '    fclose(fid);'...
                        '    clear fid ans title len;'...
                    '    else'...
                           '    set(len_base,''string'',''300'');'...
                    '    end;'...
                    '    set(tit_hist,''enable'',''on'');'...
                    '    set(txt_mean_hist,''enable'',''on'');'...
                    '    set(mean_hist,''enable'',''on'');'...
                    '    set(txt_std_hist,''enable'',''on'');'...
                    '    set(std_hist,''enable'',''on'');'...
                    '    set(mean_hist,''visible'',''on'');'...
                    '    set(std_hist,''visible'',''on'');'...
                    '    set(select_aux,''enable'',''on'');'...
                    ... % search respiratory or cardiac markers
                    ... % -------------------------------------
                    '    if exist(''histo_graph'')'...
                        '    try'...
                            '    delete(histo_graph);'...
                            '    clear(''histo_graph'');'...
                        '    catch'...
                            '    clear(''histo_graph'');'...
                        '    end;'...
                    '    end;'...
					'    progressbar(1);'...
					'    if (ok_ch == 1) || (ok_ch == 2)'...
						'    [lc,vr] = find_resp_marks(aux_raw,EEG.srate,''startinspi'');'...
					'    elseif (ok_ch == 3)'...
						'    [qrs_amp_raw,qrs_i_raw,delay]=pan_tompkin(aux_raw,EEG.srate,1);'...
						'    vr = diff(qrs_i_raw);'...
					'    end;'...
					'    disp(''The histograph is in preparation...'');'...
                    ... % Plot histograph
                    ... % ---------------
                    '    set(0,''Units'',''normalized'');'...
                    '    scrsz = get(0,''ScreenSize'');'...
                    '    histo_graph = axes(''Position'',[scrsz(3)/1.8, scrsz(4)/1.9, scrsz(3)/4, scrsz(4)/6]);'...
                    '    true_EEGtimes = (abs(EEG.xmin) + abs(EEG.xmax)) * 1000;'...
                    '    if EEG.pnts ~= true_EEGtimes'...
                        '    rap = true_EEGtimes/EEG.pnts;'...
                        '    vr = vr * rap;'...
                    '    end;'...
                    '    clear true_EEGtimes rap;'...
                    '    hist(vr,30);'...
                    '    set(mean_hist,''string'',num2str(mean(vr)));'...
                    '    set(std_hist,''string'',num2str(std(vr,1)));'...
					'    disp(''Done.'');'...
                '    elseif isempty(aux_raw_p) && isempty(aux_raw_f) && isempty(aux_raw_c)'...
                    '    set(automatic_baseline,''enable'',''off'');'...
                    '    set(automatic_baseline,''value'',0);'...
                    '    set(manual_baseline,''enable'',''on'');'...
                    '    set(manual_baseline,''value'',1);'...
                    '    set(text_baseline_limits,''enable'','' on'');'... 
                    '    set(baseline_limits,''enable'','' on'');'... 
                    '    if exist(''latest_manual_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                        '    fid = fopen(''latest_manual_baseline.txt'',''r'');'...
                        '    [title,valmin,valmax] = strread(fgets(fid), ''%s %f %f'');'... % Go to the second line
                        '    val = [num2str(valmin) '' '' num2str(valmax)];'...
                        '    set(baseline_limits,''string'',val);'...
                        '    fclose(fid);'...
                        '    clear fid ans title val valmin valmax;'...
                    '    else'...
                        '    val = [num2str(EEG.xmin*1000) '' '' num2str(0)];'...
						'    set(baseline_limits,''string'',val);'...
                    '    end;'...
                    '    set(text_aux,''enable'',''off'');'...
                    '    set(pression_base,''enable'',''off'');'...
                    '    set(pression_base,''value'',0);'...
                    '    set(flow_base,''enable'',''off'');'...
                    '    set(flow_base,''value'',0);'...
					'    set(cardiac_base,''enable'',''off'');'...
                    '    set(cardiac_base,''value'',0);'...
                    '    set(where,''enable'','' off'');'...                
                    '    set(beginspi,''enable'',''off'');'...
                    '    set(beginspi,''value'',0);'...
                    '    set(begexpi,''enable'',''off'');'...
                    '    set(begexpi,''value'',0);'...
                    '    set(peakmax,''enable'',''off'');'...
                    '    set(peakmax,''value'',0);'...
                    '    set(peakmin,''enable'',''off'');'...
                    '    set(peakmin,''value'',0);'...
                    '    set(text_latency,''enable'',''off'');'...
                    '    set(latpos,''enable'',''off'');'...
                    '    set(latpos,''value'',0);'...
                    '    set(latneg,''enable'',''off'');'...
                    '    set(latneg,''value'',0);'...
                    '    set(text_len_base,''enable'',''off'');'...
                    '    set(len_base,''enable'',''off'');'...
                    '    set(len_base,''string'','' '');'...
                    '    set(button_baseline,''enable'',''off'');'...
                    '    set(tit_hist,''enable'',''off'');'...
                    '    set(txt_mean_hist,''enable'',''off'');'...
                    '    set(mean_hist,''enable'',''off'');'...
                    '    set(txt_std_hist,''enable'',''off'');'...
                    '    set(std_hist,''enable'',''off'');'...
                    '    set(mean_hist,''visible'',''off'');'...
                    '    set(std_hist,''visible'',''off'');'...
                    '    set(select_aux,''enable'',''on'');'...
					'    progressbar(0.9);'...
                    ...
                    ... % Deletion ACCEPTBASELINE and histogram
                    ... % -------------------------------------
                    '    if exist(''ACCEPTBASELINE'')'...
                        '    clear ACCEPTBASELINE;'...
                    '    end;'...
                    '    if exist(''histo_graph'')'...
                        '    try'...
                            '    delete(histo_graph);'...
                            '    clear(''histo_graph'');'...
                        '    catch'...
                            '    clear(''histo_graph'');'...
                        '    end;'...
                    '    end;'...
					'    progressbar(1);'...
                    '    clear len;'...
                '    end;'...
            'end;'...
            'clear indice_chan ok_ch automatic_baseline manual_baseline text_baseline_limits baseline_limits a b c aux_raw aux_raw_p aux_raw_f aux_raw_c scrsz select_aux indice_chan qrs_amp_raw qrs_i_raw delay lc vr tit_hist txt_mean_hist mean_hist txt_std_hist std_hist ok state_baseline text_aux pression_base flow_base cardiac_base where beginspi begexpi peakmax peakmin text_latency latpos latneg text_len_base len_base button_baseline optbaseline showSignif text_signif_level signif_level;'];

        clbk_automatic_baseline = [...
            'automatic_baseline = findobj(''parent'', gcbf, ''tag'', ''automatic_baseline'');'...
            'manual_baseline = findobj(''parent'', gcbf, ''tag'', ''manual_baseline'');'...
            'text_baseline_limits = findobj(''parent'', gcbf, ''tag'', ''text_baseline_limits'');'...
            'baseline_limits = findobj(''parent'', gcbf, ''tag'', ''baseline_limits'');'...
            'text_aux = findobj(''parent'', gcbf, ''tag'', ''text_aux'');'...
            'pression_base = findobj(''parent'', gcbf, ''tag'', ''pression_base'');'...
            'flow_base = findobj(''parent'', gcbf, ''tag'', ''flow_base'');'...
			'cardiac_base = findobj(''parent'', gcbf, ''tag'', ''cardiac_base'');'...
            'where = findobj(''parent'', gcbf, ''tag'', ''where'');'...
            'beginspi = findobj(''parent'', gcbf, ''tag'', ''beginspi'');'...
            'begexpi = findobj(''parent'', gcbf, ''tag'', ''begexpi'');'...
            'peakmax = findobj(''parent'', gcbf, ''tag'', ''peakmax'');'...  
            'peakmin = findobj(''parent'', gcbf, ''tag'', ''peakmin'');'... 
            'text_latency = findobj(''parent'', gcbf, ''tag'', ''text_latency'');'...
            'latpos = findobj(''parent'', gcbf, ''tag'', ''latpos'');'...
            'latneg = findobj(''parent'', gcbf, ''tag'', ''latneg'');'...            
            'text_len_base = findobj(''parent'', gcbf, ''tag'', ''text_len_base'');'...
            'len_base = findobj(''parent'', gcbf, ''tag'', ''len_base'');'...
            'button_baseline = findobj(''parent'', gcbf, ''tag'', ''button_baseline'');'...
            'tit_hist = findobj(''parent'', gcbf, ''tag'', ''tit_hist'');'...
            'txt_mean_hist = findobj(''parent'', gcbf, ''tag'', ''txt_mean_hist'');'...
            'mean_hist = findobj(''parent'', gcbf, ''tag'', ''mean_hist'');'...
            'txt_std_hist = findobj(''parent'', gcbf, ''tag'', ''txt_std_hist'');'...
            'std_hist = findobj(''parent'', gcbf, ''tag'', ''std_hist'');'...
            'select_aux = findobj(''parent'',gcbf,''tag'',''select_aux'');'...
            ...
            ... % Tests if channel labels of pression and/or flow and/or cardiac exist
            '    ok = [];'...
            '    aux_raw_p = [];'...
            '    aux_raw_f = [];'...
    		'    aux_raw_c = [];'...
            '    indice_chan = 0;'...
            '    for a = 1:EEG.nbchan'...
                '    if strcmp(''Pression'',EEG.chanlocs(a).labels) || strcmp(''pression'',EEG.chanlocs(a).labels) || strcmp(''PRESSION'',EEG.chanlocs(a).labels) ||'...
                        'strcmp(''Pressure'',EEG.chanlocs(a).labels) || strcmp(''pressure'',EEG.chanlocs(a).labels) || strcmp(''PRESSURE'',EEG.chanlocs(a).labels)'...
                    '    set(pression_base,''enable'',''on'');'...
                    '    ok = [ok 1];'...
                    '    indice_chan = a;'...
                '    end;'...
            '    end;'...
            '    if indice_chan ~= 0'...
                '    for b = 1:EEG.trials'... % Construction of pression data epoch on a raw
                    '    aux_raw_p = [aux_raw_p, double(EEG.data(indice_chan,:,b))];'...
                '    end;'...
            '    end;'...
            '    for a = 1:EEG.nbchan'...
                '    if strcmp(''Debit'',EEG.chanlocs(a).labels) || strcmp(''debit'',EEG.chanlocs(a).labels) || strcmp(''D?bit'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''d?bit'',EEG.chanlocs(a).labels) || strcmp(''DEBIT'',EEG.chanlocs(a).labels) || strcmp(''Flow'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''flow'',EEG.chanlocs(a).labels) || strcmp(''FLOW'',EEG.chanlocs(a).labels) || strcmp(''Débit'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''débit'',EEG.chanlocs(a).labels) || strcmp(''dÃ©bit'',EEG.chanlocs(a).labels) || strcmp(''DÃ©bit'',EEG.chanlocs(a).labels)'...
                    '    set(flow_base,''enable'',''on'');'...
                    '    ok = [ok 2];'...
                    '    indice_chan = a;'...
                '    end;'...
            '    end;'...
            '    if indice_chan ~= 0'...
                '    for b = 1:EEG.trials'... % Construction of flow data epoch on a raw
                    '    aux_raw_f = [aux_raw_f, double(EEG.data(indice_chan,:,b))];'...
                '    end;'...
            '    end;'...
            '    for a = 1:EEG.nbchan'...
                '    if strcmp(''CARDIAC'',EEG.chanlocs(a).labels) || strcmp(''Cardiac'',EEG.chanlocs(a).labels) || strcmp(''cardiac'',EEG.chanlocs(a).labels) ||' ...
					'strcmp(''COEUR'',EEG.chanlocs(a).labels) || strcmp(''Coeur'',EEG.chanlocs(a).labels) || strcmp(''coeur'',EEG.chanlocs(a).labels) ||' ...
					'strcmp(''ECG'',EEG.chanlocs(a).labels) || strcmp(''Ecg'',EEG.chanlocs(a).labels) || strcmp(''ecg'',EEG.chanlocs(a).labels) ||' ...
   					'strcmp(''CARDIAQUE'',EEG.chanlocs(a).labels) || strcmp(''Cardiaque'',EEG.chanlocs(a).labels) || strcmp(''cardiaque'',EEG.chanlocs(a).labels)'...
                    '    set(cardiac_base,''enable'',''on'');'...
                    '    ok = [ok 3];'...
                    '    indice_chan = a;'...
                '    end;'...
            '    end;'...
            '    if indice_chan ~= 0'...
                '    for b = 1:EEG.trials'... % Construction of cardiac data epoch on a raw
                    '    aux_raw_c = [aux_raw_c, double(EEG.data(indice_chan,:,b))];'...
                '    end;'...
            '    end;'...
            '    if ~isempty(aux_raw_p)'...
                '    set(automatic_baseline,''value'',1);'...
                '    set(manual_baseline,''value'',0);'...
                '    set(text_baseline_limits,''enable'','' off'');'...
                '    set(baseline_limits,''enable'','' off'');'...
                '    if exist(''latest_manual_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                    '    fid = fopen(''latest_manual_baseline.txt'',''r'');'...
                    '    [title,valmin,valmax] = strread(fgets(fid), ''%s %f %f'');'... % Go to the second line
                    '    val = [num2str(valmin) '' '' num2str(valmax)];'...
                    '    set(baseline_limits,''string'',val);'...
                    '    fclose(fid);'...
                    '    clear fid ans title val valmin valmax;'...
                '    else'...
                    '    val = [num2str(EEG.xmin*1000) '' '' num2str(0)];'...
					'    set(baseline_limits,''string'',val);'...
                '    end;'...
                '    set(pression_base,''value'',1);'...
                '    set(flow_base,''value'',0);'...
                '    set(cardiac_base,''value'',0);'...
                '    aux_raw = aux_raw_p;'...
                '    set(where,''enable'',''on'');'...
                '    set(beginspi,''enable'',''on'');'...
                '    set(beginspi,''value'',1);'...
                '    set(begexpi,''enable'',''on'');'...
                '    set(begexpi,''value'',0);'...
                '    set(peakmax,''enable'',''on'');'...
                '    set(peakmax,''value'',0);'...
                '    set(peakmin,''enable'',''on'');'...
                '    set(peakmin,''value'',0);'...
                '    ok_ch = 1;'...
            '    elseif isempty(aux_raw_p) && ~isempty(aux_raw_f)'...
                '    set(automatic_baseline,''value'',1);'...
                '    set(manual_baseline,''value'',0);'...
                '    set(text_baseline_limits,''enable'','' off'');'...
                '    set(baseline_limits,''enable'','' off'');'...
                '    if exist(''latest_manual_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                    '    fid = fopen(''latest_manual_baseline.txt'',''r'');'...
                    '    [title,valmin,valmax] = strread(fgets(fid), ''%s %f %f'');'... % Go to the second line
                    '    val = [num2str(valmin) '' '' num2str(valmax)];'...
                    '    set(baseline_limits,''string'',val);'...
                    '    fclose(fid);'...
                    '    clear fid ans title val valmin valmax;'...
                '    else'...
                    '    val = [num2str(EEG.xmin*1000) '' '' num2str(0)];'...
					'    set(baseline_limits,''string'',val);'...
                '    end;'...
                '    set(pression_base,''value'',0);'...
                '    set(flow_base,''value'',1);'...
                '    set(cardiac_base,''value'',0);'...
                '    aux_raw = aux_raw_f;'...
                '    set(where,''enable'',''on'');'...
                '    set(beginspi,''enable'',''on'');'...
                '    set(beginspi,''value'',1);'...
                '    set(begexpi,''enable'',''on'');'...
                '    set(begexpi,''value'',0);'...
                '    set(peakmax,''enable'',''on'');'...
                '    set(peakmax,''value'',0);'...
                '    set(peakmin,''enable'',''on'');'...
                '    set(peakmin,''value'',0);'...
                '    ok_ch = 2;'...
            '    elseif isempty(aux_raw_p) && isempty(aux_raw_f) && ~isempty(aux_raw_c)'...
                '    set(automatic_baseline,''value'',1);'...
                '    set(manual_baseline,''value'',0);'...
                '    set(text_baseline_limits,''enable'','' off'');'...
                '    set(baseline_limits,''enable'','' off'');'...
                '    if exist(''latest_manual_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                    '    fid = fopen(''latest_manual_baseline.txt'',''r'');'...
                    '    [title,valmin,valmax] = strread(fgets(fid), ''%s %f %f'');'... % Go to the second line
                    '    val = [num2str(valmin) '' '' num2str(valmax)];'...
                    '    set(baseline_limits,''string'',val);'...
                    '    fclose(fid);'...
                    '    clear fid ans title val valmin valmax;'...
                '    else'...
                    '    val = [num2str(EEG.xmin*1000) '' '' num2str(0)];'...
					'    set(baseline_limits,''string'',val);'...
                '    end;'...
                '    set(pression_base,''value'',0);'...
                '    set(flow_base,''value'',0);'...
                '    set(cardiac_base,''value'',1);'...
                '    aux_raw = aux_raw_c;'...
                '    set(where,''enable'',''off'');'...
                '    set(beginspi,''enable'',''off'');'...
                '    set(beginspi,''value'',0);'...
                '    set(begexpi,''enable'',''off'');'...
                '    set(begexpi,''value'',0);'...
                '    set(peakmax,''enable'',''off'');'...
                '    set(peakmax,''value'',0);'...
                '    set(peakmin,''enable'',''off'');'...
                '    set(peakmin,''value'',0);'...
                '    ok_ch = 3;'...
            '    end;'...
            '    set(text_aux,''enable'',''on'');'...
            '    set(text_latency,''enable'',''on'');'...
            '    set(latpos,''enable'',''on'');'...
            '    set(latpos,''value'',1);'...
            '    set(latneg,''enable'',''on'');'...
            '    set(latneg,''value'',0);'...
            '    set(text_len_base,''enable'',''on'');'...
            '    set(len_base,''enable'',''on'');'...
            '    set(button_baseline,''enable'',''on'');'...
            '    if exist(''latest_automatic_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                '    fid = fopen(''latest_automatic_baseline.txt'',''r'');'...
                '    [title,len] = strread(fgets(fid), ''%s %f'');'... % Go to the second line
                '    set(len_base,''string'',len);'...
                '    fclose(fid);'...
                '    clear fid ans title len;'...
            '    else'...
                '    set(len_base,''string'',''300'');'...
            '    end;'...
            '    set(tit_hist,''enable'',''on'');'...
            '    set(txt_mean_hist,''enable'',''on'');'...
            '    set(mean_hist,''enable'',''on'');'...
            '    set(txt_std_hist,''enable'',''on'');'...
            '    set(std_hist,''enable'',''on'');'...
            '    set(mean_hist,''visible'',''on'');'...
            '    set(std_hist,''visible'',''on'');'...
            '    set(select_aux,''enable'',''on'');'...
            ... % search respiratory or cardiac markers
            ... % -------------------------------------
            '    if exist(''histo_graph'')'...
                '    try'...
                    '    delete(histo_graph);'...
                    '    clear(''histo_graph'');'...
                '    catch'...
                    '    clear(''histo_graph'');'...
                '    end;'...
            '    end;'...
            '    disp(''Please wait...'');'...
            '    if (ok_ch == 1) || (ok_ch == 2)'...
                '    [lc,vr] = find_resp_marks(aux_raw,EEG.srate,''startinspi'');'...
            '    elseif (ok_ch == 3)'...
                '    [qrs_amp_raw,qrs_i_raw,delay]=pan_tompkin(aux_raw,EEG.srate,1);'...
                '    vr = diff(qrs_i_raw);'...
            '    end;'...
            ... % Plot histograph
            ... % ---------------
            '    set(0,''Units'',''normalized'');'...
            '    scrsz = get(0,''ScreenSize'');'...
            '    histo_graph = axes(''Position'',[scrsz(3)/1.8, scrsz(4)/1.9, scrsz(3)/4, scrsz(4)/6]);'...
            '    true_EEGtimes = (abs(EEG.xmin) + abs(EEG.xmax)) * 1000;'...
            '    if EEG.pnts ~= true_EEGtimes'...
                '    rap = true_EEGtimes/EEG.pnts;'...
                '    vr = vr * rap;'...
            '    end;'...
            '    clear true_EEGtimes rap;'...
            '    hist(vr,30);'...
            '    set(mean_hist,''string'',num2str(mean(vr)));'...
            '    set(std_hist,''string'',num2str(std(vr,1)));'...
            'clear indice_chan ok_ch automatic_baseline manual_baseline text_baseline_limits baseline_limits a b c aux_raw aux_raw_p aux_raw_f aux_raw_c scrsz indice_chan qrs_amp_raw qrs_i_raw delay lc vr tit_hist txt_mean_hist mean_hist txt_std_hist std_hist ok text_aux pression_base flow_base cardiac_base where beginspi begexpi peakmax peakmin text_latency latpos latneg text_len_base len_base button_baseline;'];

        
        clbk_manual_baseline = [...
            'manual_baseline = findobj(''parent'', gcbf, ''tag'', ''manual_baseline'');'...
            'automatic_baseline = findobj(''parent'', gcbf, ''tag'', ''automatic_baseline'');'...            
            'text_baseline_limits = findobj(''parent'', gcbf, ''tag'', ''text_baseline_limits'');'...
            'baseline_limits = findobj(''parent'', gcbf, ''tag'', ''baseline_limits'');'...
            'text_aux = findobj(''parent'', gcbf, ''tag'', ''text_aux'');'...
            'pression_base = findobj(''parent'', gcbf, ''tag'', ''pression_base'');'...
            'flow_base = findobj(''parent'', gcbf, ''tag'', ''flow_base'');'...
			'cardiac_base = findobj(''parent'', gcbf, ''tag'', ''cardiac_base'');'...
            'where = findobj(''parent'', gcbf, ''tag'', ''where'');'...
            'beginspi = findobj(''parent'', gcbf, ''tag'', ''beginspi'');'...
            'begexpi = findobj(''parent'', gcbf, ''tag'', ''begexpi'');'...
            'peakmax = findobj(''parent'', gcbf, ''tag'', ''peakmax'');'...  
            'peakmin = findobj(''parent'', gcbf, ''tag'', ''peakmin'');'... 
            'text_latency = findobj(''parent'', gcbf, ''tag'', ''text_latency'');'...
            'latpos = findobj(''parent'', gcbf, ''tag'', ''latpos'');'...
            'latneg = findobj(''parent'', gcbf, ''tag'', ''latneg'');'...            
            'text_len_base = findobj(''parent'', gcbf, ''tag'', ''text_len_base'');'...
            'len_base = findobj(''parent'', gcbf, ''tag'', ''len_base'');'...
            'button_baseline = findobj(''parent'', gcbf, ''tag'', ''button_baseline'');'...
            'tit_hist = findobj(''parent'', gcbf, ''tag'', ''tit_hist'');'...
            'txt_mean_hist = findobj(''parent'', gcbf, ''tag'', ''txt_mean_hist'');'...
            'mean_hist = findobj(''parent'', gcbf, ''tag'', ''mean_hist'');'...
            'txt_std_hist = findobj(''parent'', gcbf, ''tag'', ''txt_std_hist'');'...
            'std_hist = findobj(''parent'', gcbf, ''tag'', ''std_hist'');'...
            'select_aux = findobj(''parent'',gcbf,''tag'',''select_aux'');'...
            ... 
            '    set(automatic_baseline,''value'',0);'...
            '    set(manual_baseline,''value'',1);'...
            '    set(text_baseline_limits,''enable'','' on'');'...
            '    set(baseline_limits,''enable'','' on'');'...
            '    if exist(''latest_manual_baseline.txt'',''file'')'... % read latest baseline in text file if exists
                '    fid = fopen(''latest_manual_baseline.txt'',''r'');'...
                '    [title,valmin,valmax] = strread(fgets(fid), ''%s %f %f'');'... % Go to the second line
                '    val = [num2str(valmin) '' '' num2str(valmax)];'...
                '    set(baseline_limits,''string'',val);'...
                '    fclose(fid);'...
                '    clear fid ans title val valmin valmax;'...
            '    else'...
                '    val = [num2str(EEG.xmin*1000) '' '' num2str(0)];'...
                '    set(baseline_limits,''string'',val);'...
            '    end;'...
            '    set(text_aux,''enable'',''off'');'...
            '    set(pression_base,''enable'',''off'');'...
            '    set(pression_base,''value'',0);'...
            '    set(flow_base,''enable'',''off'');'...
            '    set(flow_base,''value'',0);'...
            '    set(cardiac_base,''enable'',''off'');'...
            '    set(cardiac_base,''value'',0);'...
            '    set(where,''enable'','' off'');'...
            '    set(beginspi,''enable'',''off'');'...
            '    set(beginspi,''value'',0);'...
            '    set(begexpi,''enable'',''off'');'...
            '    set(begexpi,''value'',0);'...
            '    set(peakmax,''enable'',''off'');'...
            '    set(peakmax,''value'',0);'...
            '    set(peakmin,''enable'',''off'');'...
            '    set(peakmin,''value'',0);'...
            '    set(text_latency,''enable'',''off'');'...
            '    set(latpos,''enable'',''off'');'...
            '    set(latpos,''value'',0);'...
            '    set(latneg,''enable'',''off'');'...
            '    set(latneg,''value'',0);'...
            '    set(text_len_base,''enable'',''off'');'...
            '    set(len_base,''enable'',''off'');'...
            '    set(len_base,''string'','' '');'...
            '    set(button_baseline,''enable'',''off'');'...
            '    set(tit_hist,''enable'',''off'');'...
            '    set(txt_mean_hist,''enable'',''off'');'...
            '    set(mean_hist,''enable'',''off'');'...
            '    set(txt_std_hist,''enable'',''off'');'...
            '    set(std_hist,''enable'',''off'');'...
            '    set(mean_hist,''visible'',''off'');'...
            '    set(std_hist,''visible'',''off'');'...
            ...
            ... % Deletion ACCEPTBASELINE and histogram
            ... % -------------------------------------
            '    if exist(''ACCEPTBASELINE'')'...
                '    clear ACCEPTBASELINE;'...
            '    end;'...
            '    if exist(''histo_graph'')'...
                '    try'...
                    '    delete(histo_graph);'...
                    '    clear(''histo_graph'');'...
                '    catch'...
                    '    clear(''histo_graph'');'...
                '    end;'...
            '    end;'...
            'clear len;'...
            ...
            'clear indice_chan ok_ch automatic_baseline manual_baseline text_baseline_limits baseline_limits a b c aux_raw aux_raw_p aux_raw_f aux_raw_c scrsz indice_chan qrs_amp_raw qrs_i_raw delay lc vr tit_hist txt_mean_hist mean_hist txt_std_hist std_hist ok text_aux pression_base flow_base cardiac_base where beginspi begexpi peakmax peakmin text_latency latpos latneg text_len_base len_base button_baseline;'];

        
        clbk_pression_base = [...
            'if exist(''ACCEPTBASELINE'')'...
                '    clear ACCEPTBASELINE;'...
            'end;'...
            'pression_base = findobj(''parent'', gcbf, ''tag'', ''pression_base'');'...
            'flow_base = findobj(''parent'', gcbf, ''tag'', ''flow_base'');'...
			'cardiac_base = findobj(''parent'', gcbf, ''tag'', ''cardiac_base'');'...
            'beginspi = findobj(''parent'', gcbf, ''tag'', ''beginspi'');'...
            'begexpi = findobj(''parent'', gcbf, ''tag'', ''begexpi'');'...
            'peakmax = findobj(''parent'', gcbf, ''tag'', ''peakmax'');'...  
            'peakmin = findobj(''parent'', gcbf, ''tag'', ''peakmin'');'... 
            'if get(beginspi,''value'') == 1'...
                '    mark = ''startinspi'';'...
            'elseif get(begexpi,''value'') == 1'...
                '    mark = ''startexhal'';'...
            'elseif get(peakmax,''value'') == 1'...
                '    mark = ''peakmax'';'...
            'elseif get(peakmin,''value'') == 1'...
                '    mark = ''peakmin'';'...
			'elseif get(beginspi,''value'') == 0 && get(begexpi,''value'') == 0 && get(peakmax,''value'') == 0 && get(peakmin,''value'') == 0'...
				'    mark = ''startinspi'';'...
            'end;'....
            'set(pression_base,''value'',1);'...
			'set(flow_base,''value'',0);'...
			'set(cardiac_base,''value'',0);'...
			'set(beginspi,''enable'',''on'');'...
			'set(begexpi,''enable'',''on'');'...
			'set(peakmax,''enable'',''on'');'...
			'set(peakmin,''enable'',''on'');'...
			'set(beginspi,''value'',1);'...
			'set(begexpi,''value'',0);'...
			'set(peakmax,''value'',0);'...
			'set(peakmin,''value'',0);'...
            ...
            'aux_raw = [];'...
            'for a = 1:EEG.nbchan'...
                '    if strcmp(''Pression'',EEG.chanlocs(a).labels) || strcmp(''pression'',EEG.chanlocs(a).labels) || strcmp(''PRESSION'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''Pressure'',EEG.chanlocs(a).labels) || strcmp(''pressure'',EEG.chanlocs(a).labels) || strcmp(''PRESSURE'',EEG.chanlocs(a).labels)'...
                        '    set(pression_base,''enable'',''on'');'...
                        '    indice_chan = a;'...
                '    end;'...
            'end;'... 
            'for b = 1:EEG.trials'...% Construction of flow data epoch on a raw
                '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
            'end;'...
            'clear a b;'...
            ... % search respiratory markers
            ... % --------------------------
            'if exist(''histo_graph'')'...
                '    try'...
                    '    delete(histo_graph);'...
                    '    clear(''histo_graph'');'...
                '    catch'...
                    '    clear(''histo_graph'');'...
                '    end;'...
            'end;'...
            'disp(''Please wait...'');'...
            '[lc,vr] = find_resp_marks(aux_raw,EEG.srate,mark);'...
            ... % Plot histograph
            ... % ---------------
            'set(0,''Units'',''normalized'');'...
            'scrsz = get(0,''ScreenSize'');'...
            'histo_graph = axes(''Position'',[scrsz(3)/1.8, scrsz(4)/1.9, scrsz(3)/4, scrsz(4)/6]);'...
            'true_EEGtimes = (abs(EEG.xmin) + abs(EEG.xmax)) * 1000;'...
                'if EEG.pnts ~= true_EEGtimes'...
                    '    rap = true_EEGtimes/EEG.pnts;'...
                    '    vr = vr * rap;'...
                'end;'...
            'clear true_EEGtimes rap;'...
            'hist(vr,30);'...
            'mean_hist = findobj(''parent'', gcbf, ''tag'', ''mean_hist'');'...
            'std_hist = findobj(''parent'', gcbf, ''tag'', ''std_hist'');'...
            'set(mean_hist,''string'',num2str(mean(vr)));'...
            'set(std_hist,''string'',num2str(std(vr,1)));'...
            'clear mark beginspi begexpi peakmax peakmin mean_hist std_hist lc vr indice_chan aux_raw a b scrsz pression_base flow_base cardiac_base;'];
        
        clbk_flow_base = [...
            'if exist(''ACCEPTBASELINE'')'...
                '    clear ACCEPTBASELINE;'...
            'end;'...
            'pression_base = findobj(''parent'', gcbf, ''tag'', ''pression_base'');'...
            'flow_base = findobj(''parent'', gcbf, ''tag'', ''flow_base'');'...
			'cardiac_base = findobj(''parent'', gcbf, ''tag'', ''cardiac_base'');'...
            'beginspi = findobj(''parent'', gcbf, ''tag'', ''beginspi'');'...
            'begexpi = findobj(''parent'', gcbf, ''tag'', ''begexpi'');'...
            'peakmax = findobj(''parent'', gcbf, ''tag'', ''peakmax'');'...  
            'peakmin = findobj(''parent'', gcbf, ''tag'', ''peakmin'');'... 
            'if get(beginspi,''value'') == 1'...
                '    mark = ''startinspi'';'...
            'elseif get(begexpi,''value'') == 1'...
                '    mark = ''startexhal'';'...
            'elseif get(peakmax,''value'') == 1'...
                '    mark = ''peakmax'';'...
            'elseif get(peakmin,''value'') == 1'...
                '    mark = ''peakmin'';'...
			'elseif get(beginspi,''value'') == 0 && get(begexpi,''value'') == 0 && get(peakmax,''value'') == 0 && get(peakmin,''value'') == 0'...
				'    mark = ''startinspi'';'...
            'end;'....
            'set(pression_base,''value'',0);'...
			'set(flow_base,''value'',1);'...
			'set(cardiac_base,''value'',0);'...
			'set(beginspi,''enable'',''on'');'...
			'set(begexpi,''enable'',''on'');'...
			'set(peakmax,''enable'',''on'');'...
			'set(peakmin,''enable'',''on'');'...
			'set(beginspi,''value'',1);'...
			'set(begexpi,''value'',0);'...
			'set(peakmax,''value'',0);'...
			'set(peakmin,''value'',0);'...
            ...
            'aux_raw = [];'...
            'for a = 1:EEG.nbchan'...
                '    if strcmp(''Debit'',EEG.chanlocs(a).labels) || strcmp(''debit'',EEG.chanlocs(a).labels) || strcmp(''D?bit'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''d?bit'',EEG.chanlocs(a).labels) || strcmp(''DEBIT'',EEG.chanlocs(a).labels) || strcmp(''Flow'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''flow'',EEG.chanlocs(a).labels) || strcmp(''FLOW'',EEG.chanlocs(a).labels) || strcmp(''Débit'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''débit'',EEG.chanlocs(a).labels) || strcmp(''dÃ©bit'',EEG.chanlocs(a).labels) || strcmp(''DÃ©bit'',EEG.chanlocs(a).labels)'...
                        '    set(flow_base,''enable'',''on'');'...
                        '    indice_chan = a;'...
                    '    end;'...
            'end;'... 
            'for b = 1:EEG.trials'...% Construction of flow data epoch on a raw
                '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
            'end;'...
            'clear a b;'...
            ... % search respiratory markers
            ... % --------------------------
            'if exist(''histo_graph'')'...
                '    try'...
                    '    delete(histo_graph);'...
                    '    clear(''histo_graph'');'...
                '    catch'...
                    '    clear(''histo_graph'');'...
                '    end;'...
            'end;'...
            'disp(''Please wait...'');'...
            '[lc,vr] = find_resp_marks(aux_raw,EEG.srate,mark);'...
            ... % Plot histograph
            ... % ---------------
            'set(0,''Units'',''normalized'');'...
            'scrsz = get(0,''ScreenSize'');'...
            'histo_graph = axes(''Position'',[scrsz(3)/1.8, scrsz(4)/1.9, scrsz(3)/4, scrsz(4)/6]);'...
            'true_EEGtimes = (abs(EEG.xmin) + abs(EEG.xmax)) * 1000;'...
                'if EEG.pnts ~= true_EEGtimes'...
                    '    rap = true_EEGtimes/EEG.pnts;'...
                    '    vr = vr * rap;'...
                'end;'...
            'clear true_EEGtimes rap;'...
            'hist(vr,30);'...
            'mean_hist = findobj(''parent'', gcbf, ''tag'', ''mean_hist'');'...
            'std_hist = findobj(''parent'', gcbf, ''tag'', ''std_hist'');'...
            'set(mean_hist,''string'',num2str(mean(vr)));'...
            'set(std_hist,''string'',num2str(std(vr,1)));'...
            'clear mark beginspi begexpi peakmax peakmin mean_hist std_hist lc vr indice_chan aux_raw a b scrsz pression_base flow_base cardiac_base;'];
			
		clbk_cardiac_base = [...
			'wh = warndlg(''The algorithm will detect R-waves.'',''Information box'');'...
			'uiwait(wh);'...
            'if exist(''ACCEPTBASELINE'')'...
                '    clear ACCEPTBASELINE;'...
            'end;'...
            'pression_base = findobj(''parent'', gcbf, ''tag'', ''pression_base'');'...
            'flow_base = findobj(''parent'', gcbf, ''tag'', ''flow_base'');'...
			'cardiac_base = findobj(''parent'', gcbf, ''tag'', ''cardiac_base'');'...
            'beginspi = findobj(''parent'', gcbf, ''tag'', ''beginspi'');'...
            'begexpi = findobj(''parent'', gcbf, ''tag'', ''begexpi'');'...
            'peakmax = findobj(''parent'', gcbf, ''tag'', ''peakmax'');'...  
            'peakmin = findobj(''parent'', gcbf, ''tag'', ''peakmin'');'... 
            'if get(beginspi,''value'') == 1'...
                '    mark = ''startinspi'';'...
            'elseif get(begexpi,''value'') == 1'...
                '    mark = ''startexhal'';'...
            'elseif get(peakmax,''value'') == 1'...
                '    mark = ''peakmax'';'...
            'elseif get(peakmin,''value'') == 1'...
                '    mark = ''peakmin'';'...
			'elseif get(beginspi,''value'') == 0 && get(begexpi,''value'') == 0 && get(peakmax,''value'') == 0 && get(peakmin,''value'') == 0'...
				'    mark = ''startinspi'';'...
            'end;'....
            'set(cardiac_base,''value'',1);'...
			'set(pression_base,''value'',0);'...
			'set(flow_base,''value'',0);'...
			'set(beginspi,''enable'',''off'');'...
			'set(beginspi,''value'',0);'...
			'set(begexpi,''enable'',''off'');'...
			'set(begexpi,''value'',0);'...
			'set(peakmax,''enable'',''off'');'...
			'set(peakmax,''value'',0);'...
			'set(peakmin,''enable'',''off'');'...
			'set(peakmin,''value'',0);'...
            ...
            'aux_raw = [];'...
            'for a = 1:EEG.nbchan'...
                '    if strcmp(''CARDIAC'',EEG.chanlocs(a).labels) || strcmp(''Cardiac'',EEG.chanlocs(a).labels) || strcmp(''cardiac'',EEG.chanlocs(a).labels) ||' ...
                    'strcmp(''COEUR'',EEG.chanlocs(a).labels) || strcmp(''Coeur'',EEG.chanlocs(a).labels) || strcmp(''coeur'',EEG.chanlocs(a).labels) ||' ...
                    'strcmp(''ECG'',EEG.chanlocs(a).labels) || strcmp(''Ecg'',EEG.chanlocs(a).labels) || strcmp(''ecg'',EEG.chanlocs(a).labels) ||' ...
                    'strcmp(''CARDIAQUE'',EEG.chanlocs(a).labels) || strcmp(''Cardiaque'',EEG.chanlocs(a).labels) || strcmp(''cardiaque'',EEG.chanlocs(a).labels)'...
                    '    indice_chan = a;'...
				'    end;'...
            'end;'... 
            'for b = 1:EEG.trials'...% Construction of flow data epoch on a raw
                '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
            'end;'...
            'clear a b wh;'...
            ... % search cardiac markers
            ... % ----------------------
            'if exist(''histo_graph'')'...
                '    try'...
                    '    delete(histo_graph);'...
                    '    clear(''histo_graph'');'...
                '    catch'...
                    '    clear(''histo_graph'');'...
                '    end;'...
            'end;'...
            'disp(''Please wait...'');'...
            '[qrs_amp_raw,qrs_i_raw,delay]=pan_tompkin(aux_raw,EEG.srate,1);'...
			'vr = diff(qrs_i_raw);'...
            ... % Plot histograph
            ... % ---------------
            'set(0,''Units'',''normalized'');'...
            'scrsz = get(0,''ScreenSize'');'...
            'histo_graph = axes(''Position'',[scrsz(3)/1.8, scrsz(4)/1.9, scrsz(3)/4, scrsz(4)/6]);'...
            'true_EEGtimes = (abs(EEG.xmin) + abs(EEG.xmax)) * 1000;'...
                'if EEG.pnts ~= true_EEGtimes'...
                    '    rap = true_EEGtimes/EEG.pnts;'...
                    '    vr = vr * rap;'...
                'end;'...
            'clear true_EEGtimes rap;'...
            'hist(vr,30);'...
            'mean_hist = findobj(''parent'', gcbf, ''tag'', ''mean_hist'');'...
            'std_hist = findobj(''parent'', gcbf, ''tag'', ''std_hist'');'...
            'set(mean_hist,''string'',num2str(mean(vr)));'...
            'set(std_hist,''string'',num2str(std(vr,1)));'...
            'clear mark beginspi begexpi peakmax peakmin mean_hist std_hist vr qrs_amp_raw qrs_i_raw delay indice_chan aux_raw a b scrsz pression_base flow_base carddiac_base;'];
        
        clbk_beginspi = [...
            'if exist(''ACCEPTBASELINE'')'...
                '    clear ACCEPTBASELINE;'...
            'end;'...
            'set(findobj(''parent'', gcbf, ''tag'', ''beginspi''),''value'',1);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''begexpi''),''value'',0);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''peakmax''),''value'',0);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''peakmin''),''value'',0);'...
            ...
            'aux_raw = [];'...
            'if get(findobj(''parent'',gcbf,''tag'',''pression_base''),''value'') == 1'...
                '    for a = 1:EEG.nbchan'...
					'	if strcmp(''Pression'',EEG.chanlocs(a).labels) || strcmp(''pression'',EEG.chanlocs(a).labels) || strcmp(''PRESSION'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''Pressure'',EEG.chanlocs(a).labels) || strcmp(''pressure'',EEG.chanlocs(a).labels) || strcmp(''PRESSURE'',EEG.chanlocs(a).labels)'...
						'    indice_chan = a;'...
					'   end;'...
                '    end;'...
                '    for b = 1:EEG.trials'... % Construction of pression data epoch on a raw
                    '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
                '    end;'...
            'elseif get(findobj(''parent'',gcbf,''tag'',''flow_base''),''value'') == 1'...
                '    for a = 1:EEG.nbchan'...
                    '    if strcmp(''Debit'',EEG.chanlocs(a).labels) || strcmp(''debit'',EEG.chanlocs(a).labels) || strcmp(''D?bit'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''d?bit'',EEG.chanlocs(a).labels) || strcmp(''DEBIT'',EEG.chanlocs(a).labels) || strcmp(''Flow'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''flow'',EEG.chanlocs(a).labels) || strcmp(''FLOW'',EEG.chanlocs(a).labels) || strcmp(''Débit'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''débit'',EEG.chanlocs(a).labels) || strcmp(''dÃ©bit'',EEG.chanlocs(a).labels) || strcmp(''DÃ©bit'',EEG.chanlocs(a).labels)'...
                        '    indice_chan = a;'...
                    '    end;'...
                '    end;'... 
                '    for b = 1:EEG.trials'...% Construction of flow data epoch on a raw
                    '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
                '    end;'...
            'end;'...
            'clear a b;'...
            ... % search respiratory markers
            ... % --------------------------
            'if exist(''histo_graph'')'...
                '    try'...
                    '    delete(histo_graph);'...
                    '    clear(''histo_graph'');'...
                '    catch'...
                    '    clear(''histo_graph'');'...
                '    end;'...
            'end;'...
            'disp(''Please wait...'');'...
            '[lc,vr] = find_resp_marks(aux_raw,EEG.srate,''startinspi'');'...
            ... % Plot histograph
            ... % ---------------
            'set(0,''Units'',''normalized'');'...
            'scrsz = get(0,''ScreenSize'');'...
            'histo_graph = axes(''Position'',[scrsz(3)/1.8, scrsz(4)/1.9, scrsz(3)/4, scrsz(4)/6]);'...
            'true_EEGtimes = (abs(EEG.xmin) + abs(EEG.xmax)) * 1000;'...
                'if EEG.pnts ~= true_EEGtimes'...
                    '    rap = true_EEGtimes/EEG.pnts;'...
                    '    vr = vr * rap;'...
                'end;'...
            'clear true_EEGtimes rap;'...
            'hist(vr,30);'...
            'mean_hist = findobj(''parent'', gcbf, ''tag'', ''mean_hist'');'...
            'std_hist = findobj(''parent'', gcbf, ''tag'', ''std_hist'');'...
            'set(mean_hist,''string'',num2str(mean(vr)));'...
            'set(std_hist,''string'',num2str(std(vr,1)));'...
            'clear mean_hist std_hist lc vr indice_chan aux_raw a b scrsz;'];
        
        clbk_begexpi = [...
            'if exist(''ACCEPTBASELINE'')'...
                '    clear ACCEPTBASELINE;'...
            'end;'...
            'set(findobj(''parent'', gcbf, ''tag'', ''beginspi''),''value'',0);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''begexpi''),''value'',1);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''peakmax''),''value'',0);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''peakmin''),''value'',0);'...
            ...
            'aux_raw = [];'...
            'if get(findobj(''parent'',gcbf,''tag'',''pression_base''),''value'') == 1'...
                '    for a = 1:EEG.nbchan'...
                    '	if strcmp(''Pression'',EEG.chanlocs(a).labels) || strcmp(''pression'',EEG.chanlocs(a).labels) || strcmp(''PRESSION'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''Pressure'',EEG.chanlocs(a).labels) || strcmp(''pressure'',EEG.chanlocs(a).labels) || strcmp(''PRESSURE'',EEG.chanlocs(a).labels)'...
						'    indice_chan = a;'...
					'   end;'...
                '    end;'...
                '    for b = 1:EEG.trials'... % Construction of pression data epoch on a raw
                    '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
                '    end;'...
            'elseif get(findobj(''parent'',gcbf,''tag'',''flow_base''),''value'') == 1'...
                '    for a = 1:EEG.nbchan'...
                    '    if strcmp(''Debit'',EEG.chanlocs(a).labels) || strcmp(''debit'',EEG.chanlocs(a).labels) || strcmp(''D?bit'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''d?bit'',EEG.chanlocs(a).labels) || strcmp(''DEBIT'',EEG.chanlocs(a).labels) || strcmp(''Flow'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''flow'',EEG.chanlocs(a).labels) || strcmp(''FLOW'',EEG.chanlocs(a).labels) || strcmp(''Débit'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''débit'',EEG.chanlocs(a).labels) || strcmp(''dÃ©bit'',EEG.chanlocs(a).labels) || strcmp(''DÃ©bit'',EEG.chanlocs(a).labels)'...
                        '    indice_chan = a;'...
                    '    end;'...
                '    end;'... 
                '    for b = 1:EEG.trials'...% Construction of flow data epoch on a raw
                    '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
                '    end;'...
            'end;'...
            'clear a b;'...
            ... % search respiratory markers
            ... % --------------------------
            'if exist(''histo_graph'')'...
                '    try'...
                    '    delete(histo_graph);'...
                    '    clear(''histo_graph'');'...
                '    catch'...
                    '    clear(''histo_graph'');'...
                '    end;'...
            'end;'...
            'disp(''Please wait...'');'...
            '[lc,vr] = find_resp_marks(aux_raw,EEG.srate,''startexhal'');'...
            ... % Plot histograph
            ... % ---------------
            'set(0,''Units'',''normalized'');'...
            'scrsz = get(0,''ScreenSize'');'...
            'histo_graph = axes(''Position'',[scrsz(3)/1.8, scrsz(4)/1.9, scrsz(3)/4, scrsz(4)/6]);'...
            'true_EEGtimes = (abs(EEG.xmin) + abs(EEG.xmax)) * 1000;'...
                'if EEG.pnts ~= true_EEGtimes'...
                    '    rap = true_EEGtimes/EEG.pnts;'...
                    '    vr = vr * rap;'...
                'end;'...
            'clear true_EEGtimes rap;'...
            'hist(vr,30);'...
            'mean_hist = findobj(''parent'', gcbf, ''tag'', ''mean_hist'');'...
            'std_hist = findobj(''parent'', gcbf, ''tag'', ''std_hist'');'...
            'set(mean_hist,''string'',num2str(mean(vr)));'...
            'set(std_hist,''string'',num2str(std(vr,1)));'...
            'clear mean_hist std_hist lc vr indice_chan aux_raw a b scrsz;'];
        
        clbk_peakmax = [...
            'if exist(''ACCEPTBASELINE'')'...
                '    clear ACCEPTBASELINE;'...
            'end;'...
            'set(findobj(''parent'', gcbf, ''tag'', ''beginspi''),''value'',0);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''begexpi''),''value'',0);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''peakmax''),''value'',1);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''peakmin''),''value'',0);'...
            ...
            'aux_raw = [];'...
            'if get(findobj(''parent'',gcbf,''tag'',''pression_base''),''value'') == 1'...
                '    for a = 1:EEG.nbchan'...
                    '	if strcmp(''Pression'',EEG.chanlocs(a).labels) || strcmp(''pression'',EEG.chanlocs(a).labels) || strcmp(''PRESSION'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''Pressure'',EEG.chanlocs(a).labels) || strcmp(''pressure'',EEG.chanlocs(a).labels) || strcmp(''PRESSURE'',EEG.chanlocs(a).labels)'...
						'    indice_chan = a;'...
					'   end;'...
                '    end;'...
                '    for b = 1:EEG.trials'... % Construction of pression data epoch on a raw
                    '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
                '    end;'...
            'elseif get(findobj(''parent'',gcbf,''tag'',''flow_base''),''value'') == 1'...
                '    for a = 1:EEG.nbchan'...
                    '    if strcmp(''Debit'',EEG.chanlocs(a).labels) || strcmp(''debit'',EEG.chanlocs(a).labels) || strcmp(''D?bit'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''d?bit'',EEG.chanlocs(a).labels) || strcmp(''DEBIT'',EEG.chanlocs(a).labels) || strcmp(''Flow'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''flow'',EEG.chanlocs(a).labels) || strcmp(''FLOW'',EEG.chanlocs(a).labels) || strcmp(''Débit'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''débit'',EEG.chanlocs(a).labels) || strcmp(''dÃ©bit'',EEG.chanlocs(a).labels) || strcmp(''DÃ©bit'',EEG.chanlocs(a).labels)'...
                        '    indice_chan = a;'...
                    '    end;'...
                '    end;'... 
                '    for b = 1:EEG.trials'...% Construction of flow data epoch on a raw
                    '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
                '    end;'...
            'end;'...
            'clear a b;'...
            ... % search respiratory markers
            ... % --------------------------
            'if exist(''histo_graph'')'...
                '    try'...
                    '    delete(histo_graph);'...
                    '    clear(''histo_graph'');'...
                '    catch'...
                    '    clear(''histo_graph'');'...
                '    end;'...
            'end;'...
            'disp(''Please wait...'');'...
            '[lc,vr] = find_resp_marks(aux_raw,EEG.srate,''peakmax'');'...
            ... % Plot histograph
            ... % ---------------
            'set(0,''Units'',''normalized'');'...
            'scrsz = get(0,''ScreenSize'');'...
            'histo_graph = axes(''Position'',[scrsz(3)/1.8, scrsz(4)/1.9, scrsz(3)/4, scrsz(4)/6]);'...
            'true_EEGtimes = (abs(EEG.xmin) + abs(EEG.xmax)) * 1000;'...
                'if EEG.pnts ~= true_EEGtimes'...
                    '    rap = true_EEGtimes/EEG.pnts;'...
                    '    vr = vr * rap;'...
                'end;'...
            'clear true_EEGtimes rap;'...
            'hist(vr,30);'...
            'mean_hist = findobj(''parent'', gcbf, ''tag'', ''mean_hist'');'...
            'std_hist = findobj(''parent'', gcbf, ''tag'', ''std_hist'');'...
            'set(mean_hist,''string'',num2str(mean(vr)));'...
            'set(std_hist,''string'',num2str(std(vr,1)));'...
            'clear mean_hist std_hist lc vr indice_chan aux_raw a b scrsz;' ];
        
        clbk_peakmin = [...
            'if exist(''ACCEPTBASELINE'')'...
                '    clear ACCEPTBASELINE;'...
            'end;'...
            'set(findobj(''parent'', gcbf, ''tag'', ''beginspi''),''value'',0);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''begexpi''),''value'',0);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''peakmax''),''value'',0);'...
            'set(findobj(''parent'', gcbf, ''tag'', ''peakmin''),''value'',1);'...
            ...
            'aux_raw = [];'...
            'if get(findobj(''parent'',gcbf,''tag'',''pression_base''),''value'') == 1'...
                '    for a = 1:EEG.nbchan'...
                    '	if strcmp(''Pression'',EEG.chanlocs(a).labels) || strcmp(''pression'',EEG.chanlocs(a).labels) || strcmp(''PRESSION'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''Pressure'',EEG.chanlocs(a).labels) || strcmp(''pressure'',EEG.chanlocs(a).labels) || strcmp(''PRESSURE'',EEG.chanlocs(a).labels)'...
						'    indice_chan = a;'...
					'   end;'...
                '    end;'...
                '    for b = 1:EEG.trials'... % Construction of pression data epoch on a raw
                    '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
                '    end;'...
            'elseif get(findobj(''parent'',gcbf,''tag'',''flow_base''),''value'') == 1'...
                '    for a = 1:EEG.nbchan'...
                    '    if strcmp(''Debit'',EEG.chanlocs(a).labels) || strcmp(''debit'',EEG.chanlocs(a).labels) || strcmp(''D?bit'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''d?bit'',EEG.chanlocs(a).labels) || strcmp(''DEBIT'',EEG.chanlocs(a).labels) || strcmp(''Flow'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''flow'',EEG.chanlocs(a).labels) || strcmp(''FLOW'',EEG.chanlocs(a).labels) || strcmp(''Débit'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''débit'',EEG.chanlocs(a).labels) || strcmp(''dÃ©bit'',EEG.chanlocs(a).labels) || strcmp(''DÃ©bit'',EEG.chanlocs(a).labels)'...
                        '    indice_chan = a;'...
                    '    end;'...
                '    end;'... 
                '    for b = 1:EEG.trials'...% Construction of flow data epoch on a raw
                    '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
                '    end;'...
            'end;'...
            'clear a b;'...
            ... % search respiratory markers
            ... % --------------------------
            'if exist(''histo_graph'')'...
                '    try'...
                    '    delete(histo_graph);'...
                    '    clear(''histo_graph'');'...
                '    catch'...
                    '    clear(''histo_graph'');'...
                '    end;'...
            'end;'...
            'disp(''Please wait...'');'...
            '[lc,vr] = find_resp_marks(aux_raw,EEG.srate,''peakmin'');'...
            ... % Plot histograph
            ... % ---------------
            'set(0,''Units'',''normalized'');'...
            'scrsz = get(0,''ScreenSize'');'...
            'histo_graph = axes(''Position'',[scrsz(3)/1.8, scrsz(4)/1.9, scrsz(3)/4, scrsz(4)/6]);'...
            'true_EEGtimes = (abs(EEG.xmin) + abs(EEG.xmax)) * 1000;'...
                'if EEG.pnts ~= true_EEGtimes'...
                    '    rap = true_EEGtimes/EEG.pnts;'...
                    '    vr = vr * rap;'...
                'end;'...
            'clear true_EEGtimes rap;'...
            'hist(vr,30);'...
            'mean_hist = findobj(''parent'', gcbf, ''tag'', ''mean_hist'');'...
            'std_hist = findobj(''parent'', gcbf, ''tag'', ''std_hist'');'...
            'set(mean_hist,''string'',num2str(mean(vr)));'...
            'set(std_hist,''string'',num2str(std(vr,1)));'...
            'clear mean_hist std_hist lc vr indice_chan aux_raw a b scrsz;'];
        
        clbk_latpos = [...
            'if exist(''ACCEPTBASELINE'')'...
                '    clear ACCEPTBASELINE;'...
            'end;'...
            'latpos = findobj(''parent'', gcbf, ''tag'', ''latpos'');'...
            'latneg = findobj(''parent'', gcbf, ''tag'', ''latneg'');'...
            'if get(latpos,''value'') == 1'...
                '    set(latneg,''value'',0);'...
            'else'...
                '    set(latneg,''value'',1);'...
            'end;'...
            'clear latpos latneg;'];
        
        clbk_latneg = [...
            'if exist(''ACCEPTBASELINE'')'...
                '    clear ACCEPTBASELINE;'...
            'end;'...
            'latpos = findobj(''parent'', gcbf, ''tag'', ''latpos'');'...
            'latneg = findobj(''parent'', gcbf, ''tag'', ''latneg'');'...
            'if get(latneg,''value'') == 1'...
                '    set(latpos,''value'',0);'...
            'else'...
                '    set(latpos,''value'',1);'...
            'end;'...
            'clear latpos latneg;'];
        
        clbk_buttonbase = [...
            ... % Recovery of markers for the start of baseline
            ... % ---------------------------------------------
			'progressbar(''Preparing the baselines plot...'');'...
            'if get(findobj(''parent'',gcbf,''tag'',''beginspi''),''value'') == 1'...
                '    mark = ''startinspi'';'...
            'elseif get(findobj(''parent'',gcbf,''tag'',''begexpi''),''value'') == 1'...
                '    mark = ''startexhal'';'...
            'elseif get(findobj(''parent'',gcbf,''tag'',''peakmax''),''value'') == 1'...
                '    mark = ''peakmax'';'...
            'elseif get(findobj(''parent'',gcbf,''tag'',''peakmin''),''value'') == 1'...
                '    mark = ''peakmin'';'...
            'end;'...
            ... % read raw data
            ... % -------------
            'aux_raw = [];'...
            'if get(findobj(''parent'',gcbf,''tag'',''pression_base''),''value'') == 1'...
                '    for a = 1:EEG.nbchan'...
                    '	if strcmp(''Pression'',EEG.chanlocs(a).labels) || strcmp(''pression'',EEG.chanlocs(a).labels) || strcmp(''PRESSION'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''Pressure'',EEG.chanlocs(a).labels) || strcmp(''pressure'',EEG.chanlocs(a).labels) || strcmp(''PRESSURE'',EEG.chanlocs(a).labels)'...
						'    indice_chan = a;'...
					'   end;'...
					'   progressbar(a/EEG.nbchan*0.25);'...
                '    end;'...
                '    for b = 1:EEG.trials'... % Construction of pression data epoch on a raw
                    '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
					'    progressbar(0.25+b/EEG.trials*0.5);'...
                '    end;'...
            'elseif get(findobj(''parent'',gcbf,''tag'',''flow_base''),''value'') == 1'...
                '    for a = 1:EEG.nbchan'...
                    '    if strcmp(''Debit'',EEG.chanlocs(a).labels) || strcmp(''debit'',EEG.chanlocs(a).labels) || strcmp(''D?bit'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''d?bit'',EEG.chanlocs(a).labels) || strcmp(''DEBIT'',EEG.chanlocs(a).labels) || strcmp(''Flow'',EEG.chanlocs(a).labels) ||' ...
                            'strcmp(''flow'',EEG.chanlocs(a).labels) || strcmp(''FLOW'',EEG.chanlocs(a).labels) || strcmp(''Débit'',EEG.chanlocs(a).labels) ||'...
                            'strcmp(''débit'',EEG.chanlocs(a).labels) || strcmp(''dÃ©bit'',EEG.chanlocs(a).labels) || strcmp(''DÃ©bit'',EEG.chanlocs(a).labels)'...
                        '    indice_chan = a;'...
                    '    end;'...
					'    progressbar(a/EEG.nbchan*0.25);'...
                '    end;'... 
                '    for b = 1:EEG.trials'...% Construction of flow data epoch on a raw
                    '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
					'    progressbar(0.25+b/EEG.trials*0.5);'...
                '    end;'...
			'elseif get(findobj(''parent'',gcbf,''tag'',''cardiac_base''),''value'') == 1'...
                '    for a = 1:EEG.nbchan'...
                    '    if strcmp(''CARDIAC'',EEG.chanlocs(a).labels) || strcmp(''Cardiac'',EEG.chanlocs(a).labels) || strcmp(''cardiac'',EEG.chanlocs(a).labels) ||' ...
						'strcmp(''COEUR'',EEG.chanlocs(a).labels) || strcmp(''Coeur'',EEG.chanlocs(a).labels) || strcmp(''coeur'',EEG.chanlocs(a).labels) ||' ...
						'strcmp(''ECG'',EEG.chanlocs(a).labels) || strcmp(''Ecg'',EEG.chanlocs(a).labels) || strcmp(''ecg'',EEG.chanlocs(a).labels) ||' ...
						'strcmp(''CARDIAQUE'',EEG.chanlocs(a).labels) || strcmp(''Cardiaque'',EEG.chanlocs(a).labels) || strcmp(''cardiaque'',EEG.chanlocs(a).labels)'...
                    '    indice_chan = a;'...
					'    end;'...
					'    progressbar(a/EEG.nbchan*0.25);'...
                '    end;'... 
                '    for b = 1:EEG.trials'...% Construction of cardiac data epoch on a raw
                    '    aux_raw = [aux_raw, double(EEG.data(indice_chan,:,b))];'...
					'    progressbar(0.25+b/EEG.trials*0.5);'...
                '    end;'...
            'end;'...
            'clear a b;'...
            ... % Recovery of baseline length
            ... % ---------------------------
            'len_base = get(findobj(''parent'', gcbf, ''tag'', ''len_base''),''string'');'...
            'if isempty(len_base)'...
                '    errordlg2(''Baseline limits can not be empty. Enter correct length and choose the beginning or unchecked ''''Baseline''''.'');'...
            'elseif isspace(len_base) '...
                '    errordlg2(''Baseline limits can not be empty. Enter correct length and choose the beginning or unchecked ''''Baseline''''.'');'...
            'else'...
                '    length_written = ''None'';'...
                '    if exist(''latest_automatic_baseline.txt'',''file'')'...
                    '    fid = fopen(''latest_automatic_baseline.txt'',''r'');'...
                    '    ligne = fgetl(fid);'...
                    '    length_written = ligne(17:end);'...
                    '    fclose(fid);'...
                '    end;'...
                '    if ~strcmp(len_base,length_written)'...
                    '    if exist(''ACCEPTBASELINE'')'...
                        '    clear ACCEPTBASELINE;'...
                    '    end;'...
                    '    fid = fopen(''latest_automatic_baseline.txt'',''w'');'...
                    '    fprintf(fid,''%s %s'',''length_baseline'',len_base);'...
                    '    fclose(fid);'...
                '    end;'...
                '    clear fid ligne length_written;'...
            'end;'...
			'progressbar(1);'...
            'if ~exist(''ACCEPTBASELINE'')'...
                ... % search respiratory or cardiac markers
                ... % -------------------------------------
                '    disp(''Please wait...'');'...
				'    if (get(findobj(''parent'',gcbf,''tag'',''pression_base''),''value'') == 1) || (get(findobj(''parent'',gcbf,''tag'',''flow_base''),''value'') == 1)'...
                        '    [lc,vr] = find_resp_marks(aux_raw,EEG.srate,mark);'...
				'    elseif (get(findobj(''parent'',gcbf,''tag'',''cardiac_base''),''value'') == 1)'...
						'    [qrs_amp_raw,qrs_i_raw,delay]=pan_tompkin(aux_raw,EEG.srate,1);'...
						'    lc = qrs_i_raw;'...
				'    end;'...
                '    clear vr qrs_i_raw qrs_amp_raw delay;'...
                ... % Recovery of latency sign of the baseline
                ... % ----------------------------------------
                '    if get(findobj(''parent'',gcbf,''tag'',''latpos''),''value'') == 1'...
                    '    latency = ''pos'';'...
                '    else'...
                    '    latency = ''neg'';'...
                '    end;'...
                ... % Calculs of start and end of baseline
                ... % ------------------------------------
                '    [minb,maxb] = fcn_baseline(lc,latency,len_base);'...
                '    clear lc latency len_base ans;'...
                ... % Plot to control baseline
                ... % ------------------------
                '    CARE_eegplot (EEG.data(indice_chan,:,:),''srate'',EEG.srate,''title'',''Remove, correct, add or accept baseline on each epoch -- CARE_eegplot()'',''events'',EEG.event,''limits'',[EEG.xmin EEG.xmax]*1000,''butlabel'',''ACCEPT'',''command'',''baseline'',''baseline'',[minb; maxb]);'...
            '   else'...
                '    CARE_eegplot (EEG.data(indice_chan,:,:),''srate'',EEG.srate,''title'',''Remove, correct, add or accept baseline on each epoch -- CARE_eegplot()'',''events'',EEG.event,''limits'',[EEG.xmin EEG.xmax]*1000,''butlabel'',''ACCEPT'',''command'',''baseline'',''baseline'', ACCEPTBASELINE);'...
                '    clear len_base;'...
            'end;'...
            'clear minb maxb aux_raw mark;'];
       
        clbk_evo = [...
            'state_evo = get(findobj(''parent'', gcbf, ''tag'', ''evoked''),''value'');'...
            'state_indu = findobj(''parent'', gcbf, ''tag'', ''induced'');'...
            'if state_evo == 0'... 
                '    set(state_indu,''value'',1);'...
            'else'...
                '    set(state_indu,''value'',0);'... 
            'end;'...
            'clear state_evo state_indu;'];
        
        clbk_indu = [...
            'state_indu = get(findobj(''parent'', gcbf, ''tag'', ''induced''),''value'');'...
            'state_evo = findobj(''parent'', gcbf, ''tag'', ''evoked'');'...
            'if state_indu == 0'... 
                '    set(state_evo,''value'',1);'...
            'else'...
                '    set(state_evo,''value'',0);'... 
            'end;'...
            'clear state_evo state_indu;'];
        
        clbk_autocolorbar = [...
            'autocolorbar = get(findobj(''parent'', gcbf, ''tag'', ''autocolorbar''),''value'');'...
            'manualcolorbar = findobj(''parent'', gcbf, ''tag'', ''manualcolorbar'');'...
            'text_mincolorbar = findobj(''parent'', gcbf, ''tag'', ''text_mincolorbar'');'...
            'mincolorbar = findobj(''parent'', gcbf, ''tag'', ''mincolorbar'');'...
            'text_maxcolorbar = findobj(''parent'', gcbf, ''tag'', ''text_maxcolorbar'');'...
            'maxcolorbar = findobj(''parent'', gcbf, ''tag'', ''maxcolorbar'');'...
            'if autocolorbar == 0'... 
                '    set(manualcolorbar,''value'',1);'...
                '    set(text_mincolorbar,''enable'',''on'');'...
                '    set(mincolorbar,''enable'',''on'');'...
                '    set(text_maxcolorbar,''enable'',''on'');'...
                '    set(maxcolorbar,''enable'',''on'');'...
            'else'...
                '    set(manualcolorbar,''value'',0);'... 
                '    set(text_mincolorbar,''enable'',''off'');'...
                '    set(mincolorbar,''enable'',''off'');'...
                '    set(text_maxcolorbar,''enable'',''off'');'...
                '    set(maxcolorbar,''enable'',''off'');'...
                '    set(mincolorbar,''string'','' '');'...
                '    set(maxcolorbar,''string'','' '');'...
            'end;'...
            'clear autocolorbar manualcolorbar text_mincolorbar mincolorbar text_maxcolorbar maxcolorbar;'];
        
        clbk_manualcolorbar = [...
            'manualcolorbar = get(findobj(''parent'', gcbf, ''tag'', ''manualcolorbar''),''value'');'...
            'autocolorbar = findobj(''parent'', gcbf, ''tag'', ''autocolorbar'');'...
            'text_mincolorbar = findobj(''parent'', gcbf, ''tag'', ''text_mincolorbar'');'...
            'mincolorbar = findobj(''parent'', gcbf, ''tag'', ''mincolorbar'');'...
            'text_maxcolorbar = findobj(''parent'', gcbf, ''tag'', ''text_maxcolorbar'');'...
            'maxcolorbar = findobj(''parent'', gcbf, ''tag'', ''maxcolorbar'');'...
            'if manualcolorbar == 0'... 
                '    set(autocolorbar,''value'',1);'...
                '    set(text_mincolorbar,''enable'',''off'');'...
                '    set(mincolorbar,''enable'',''off'');'...
                '    set(text_maxcolorbar,''enable'',''off'');'...
                '    set(maxcolorbar,''enable'',''off'');'...
                '    set(mincolorbar,''string'','' '');'...
                '    set(maxcolorbar,''string'','' '');'...
            'else'...
                '    set(autocolorbar,''value'',0);'... 
                '    set(text_mincolorbar,''enable'',''on'');'...
                '    set(mincolorbar,''enable'',''on'');'...
                '    set(text_maxcolorbar,''enable'',''on'');'...
                '    set(maxcolorbar,''enable'',''on'');'...
            'end;'...
            'clear manualcolorbar autocolorbar text_mincolorbar mincolorbar text_maxcolorbar maxcolorbar;'];
        
        clbk_yes = [...
            'state_yes = get(findobj(''parent'', gcbf, ''tag'', ''yes''),''value'');'...
            'state_no = findobj(''parent'', gcbf, ''tag'', ''no'');'...
            'if state_yes == 0'... 
                '    set(state_no,''value'',1);'...
            'else'...
                '    set(state_no,''value'',0);'... 
            'end;'...
            'clear state_yes state_no;'];
        
        clbk_no = [...
            'state_no = get(findobj(''parent'', gcbf, ''tag'', ''no''),''value'');'...
            'state_yes = findobj(''parent'', gcbf, ''tag'', ''yes'');'...
            'if state_no == 0'... 
                '    set(state_yes,''value'',1);'...
            'else'...
                '    set(state_yes,''value'',0);'... 
            'end;'...
            'clear state_yes state_no;'];
        
        clbk_select_aux = [...
            'select_aux = get(findobj(''parent'', gcbf, ''tag'', ''select_aux''),''value'');'... 
            'listaux = findobj(''parent'', gcbf, ''tag'', ''listaux'');'...
            'if select_aux == 1'...
                '    set(listaux,''enable'',''on'');'...
            'else'...
                '    set(listaux,''enable'',''off'');'...
            'end;'...
            'clear select_aux listaux;'];
        
        ok_clbk = [...
            ... % Save the latest parameters used
            ... % --------------------------------------
            'showSignif = get(findobj(''parent'', gcbf, ''tag'', ''showSignif''),''value'');'...
            'signif_level = get(findobj(''parent'', gcbf, ''tag'', ''signif_level''),''string'');'...
            'lfreq = get(findobj(''parent'', gcbf, ''tag'', ''lower_freq''),''string'');'...
            'hfreq = get(findobj(''parent'', gcbf, ''tag'', ''higher_freq''),''string'');'...
            'resol = get(findobj(''parent'', gcbf, ''tag'', ''resolution''),''string'');'...
            ...
            'if isempty(lfreq) '...
                '    errordlg2(''The lowest frequency can not be empty !'');'...
            'elseif isempty(hfreq) '...
                '    errordlg2(''The highest frequency can not be empty !'');'...
            'elseif isempty(resol) '...
                '    errordlg2(''The frequency resolution can not be empty !'');'...
            'elseif (str2double(lfreq) >= 0 && str2double(hfreq) <  0.5 * EEG.srate && str2double(lfreq) < str2double(hfreq) && str2double(resol) > 0 && str2double(resol) <= 2)'...
            ...
				'    if str2double(lfreq)<2'...
					'    lfreq= ''2'';'...
				'    end;'...
				'    if str2double(resol)<0.25'...
					'    resol = ''0.25'';'...
				'    end;'...
                '    fid = fopen(''latest_parameters.txt'',''w'');'...
                '    fprintf(fid,''%s %s %s %s %s %s'',''Lower'',lfreq,'' Higher'',hfreq,'' Resolution'',resol);'...
                '    fclose(fid);'...
                '    clear fid ans;'...
            'else'...
                '    errordlg2(''The lowest frequency must be positive but higher than or equal to 2Hz, the highest frequency must be lower than 0.5 x sample rate and the lowest frequency must be inferior to the highest !'');'...
            'end;'...
            ... % --------------------------------------
            ... % Calcul of nfft
            ... % --------------------------------------
            'i = 0;'...
            'nfft = 0;'...
            'Tmin = 1*EEG.srate;'...
            'if EEG.pnts < Tmin'...
                '    errordlg2(''The number of points is too small : it must be superior to 1 second'');'...
                '    close(gcbf);'...
                '    clear i nfft Tmin;'...
            'else'...
                '    while nfft <= EEG.pnts'...
                        '    nfft = 2^i;'...
                        '    i = i+1;'...
                '    end;'...
            'end;'...
            'p = EEG.filepath;'...
            ... % --------------------------------------
            ... % Recovery of colorbar range
            ... % --------------------------------------
            'autocolorbar = get(findobj(''parent'', gcbf, ''tag'', ''autocolorbar''),''value'');'...
            'if autocolorbar == 1'...
                '    range_colorbar = ''automatic'';'...
            'else'...
                '    mincolorbar = get(findobj(''parent'', gcbf, ''tag'', ''mincolorbar''),''string'');'...
                '    maxcolorbar = get(findobj(''parent'', gcbf, ''tag'', ''maxcolorbar''),''string'');'...
                '    if isempty(deblank(mincolorbar)) || isempty(deblank(maxcolorbar))'...
                    '    errordlg2(''Range value of the colorbar can not be empty!'');'...
                    '    return;'...
                '    elseif str2num(mincolorbar) >= str2num(maxcolorbar)'...
                    '    errordlg2(''Range min must be smaller than range max !'',''error'');'...
                    '    return;'...
                '    else'...
                    '    range_colorbar = [str2num(mincolorbar), str2num(maxcolorbar)];'...
                '    end;'...
            'end;'...
            'clear autocolorbar mincolorbar maxcolorbar;'...
            ... % --------------------------------------
            ... % Save parameters of baseline
            ... % --------------------------------------
            'BASELINE = get(findobj(''parent'', gcbf, ''tag'', ''baseline''),''value'');'...
            'if BASELINE == 1'...
                '    if get(findobj(''parent'', gcbf, ''tag'', ''automatic_baseline''),''value'') == 1'...
                    '    if ~exist(''ACCEPTBASELINE'')'...
                        '    errordlg2(''Warning : you have not checked your baselines before launch calculs of time-frequency maps !'');'...
                        '    clear BASELINE hfreq lfreq resol i nfft p Tmin;'...
                        '    return;'...
                    '    end;'...
                    ... % find the nearest points time of baseline
                    ... % ----------------------------------------
                    '    minb = ACCEPTBASELINE(1,:);'...      
                    '    kal = 1;'...
                    '    counter = 0;'...
                    '    for is = length(EEG.times):length(EEG.times):length(EEG.times)*EEG.trials'...
                         '    while kal <= length(minb) && is-length(EEG.times) < minb(kal)  && minb(kal) <= is'...
                             '    minb(kal) = EEG.times(int64(minb(kal)-counter*length(EEG.times)));'...
                             '    event_assoc_minb(kal) = counter + 1;'...
                             '    kal = kal+1;'...
                         '    end;'...
                         '    counter = counter + 1;'...
                     '    end;'...
                     '    clear kal is si counter;'...
                     '    maxb = ACCEPTBASELINE(2,:);'...
                     '    kal = 1;'...
                     '    counter = 0;'...
                     '    for is = length(EEG.times):length(EEG.times):length(EEG.times)*EEG.trials'...
                          '    while kal <= length(maxb) && is-length(EEG.times) < maxb(kal)  && maxb(kal) <= is'...
                              '    maxb(kal) = EEG.times(int64(maxb(kal)-counter*length(EEG.times)));'...
                              '    event_assoc_maxb(kal) = counter + 1;'...
                              '    kal = kal+1;'...
                          '    end;'...
                          '    counter = counter + 1;'...
                     '    end;'...
                     '    clear kal is si counter;'...
                     ... % Find index of minb and maxb in EEG.times to build baseline vectors later
                     ... % ------------------------------------------------------------------------
                     '    for cle = 1:size(ACCEPTBASELINE,2)'...
                        '    MINB(cle) = find(ismember(EEG.times,minb(cle)));'...
                        '    MAXB(cle) = find(ismember(EEG.times,maxb(cle)));'...
                     '    end;'...
                     '    clear cle ACCEPTBASELINE;'...
                     ... % Recovery of markers for the start of baseline
                     ... % ---------------------------------------------
                     '    if get(findobj(''parent'',gcbf,''tag'',''beginspi''),''value'') == 1'...
                         '    marker_baseline = ''Start of inspiration'';'...
                     '    elseif get(findobj(''parent'',gcbf,''tag'',''begexpi''),''value'') == 1'...
                         '    marker_baseline = ''Start of expiration'';'...
                     '    elseif get(findobj(''parent'',gcbf,''tag'',''peakmax''),''value'') == 1'...
                         '    marker_baseline = ''Maximum of flow/pressure'';'...
                     '    elseif get(findobj(''parent'',gcbf,''tag'',''peakmin''),''value'') == 1'...
                         '    marker_baseline = ''Minimum of flow/pressure'';'...
                     '    elseif get(findobj(''parent'',gcbf,''tag'',''cardiac_base''),''value'') == 1'...
                         '    marker_baseline = ''R-wave'';'...
                     '    end;'...
                     ... % read raw data
                     ... % -------------
                     '    if get(findobj(''parent'',gcbf,''tag'',''pression_base''),''value'') == 1'...
                         '    listauxbase = ''pressure'';'...
                     '    elseif get(findobj(''parent'',gcbf,''tag'',''flow_base''),''value'') == 1'...
                         '    listauxbase = ''flow'';'...
				     '    elseif get(findobj(''parent'',gcbf,''tag'',''cardiac_base''),''value'') == 1'...
                         '    listauxbase = ''cardiac'';'...
                     '    end;'...
                     ... % Recovery of latency sign of the baseline
                     ... % ----------------------------------------
                     '    if get(findobj(''parent'',gcbf,''tag'',''latpos''),''value'') == 1'...
                         '    latency = ''after'';'...
                     '    else'...
                         '    latency = ''before'';'...
                     '    end;'...
                     ... % Recovery of baseline length
                     ... % ---------------------------
                     '    len_base = get(findobj(''parent'', gcbf, ''tag'', ''len_base''),''string'');'...
                     '    if isempty(len_base)'...
                         '    errordlg2(''Baseline limits can not be empty. Enter correct length and choose the beginning or unchecked ''''Baseline''''.'');'...
                     '    elseif isspace(len_base) '...
                         '    errordlg2(''Baseline limits can not be empty. Enter correct length and choose the beginning or unchecked ''''Baseline''''.'');'...
                     '    else'...
                         '    fid = fopen(''latest_automatic_baseline.txt'',''w'');'...
                         '    fprintf(fid,''%s %s'',''length_baseline'',len_base);'...
                         '    fclose(fid);'...
                         '    clear fid ans;'...
                     '    end;'...
                 '    else'...
                     '    baseline_limits = get(findobj(''parent'', gcbf, ''tag'', ''baseline_limits''),''string'');'...
                     '    if ~isempty( baseline_limits )'...
                         '    limit = [ str2num(baseline_limits)];'...
                         '    minB = limit(1);'...
                         '    maxB = limit(2);'...
                         '    if minB < EEG.xmin * 1000 || maxB >0 || minB>=maxB'...
                                '    errordlg2(sprintf(''Baseline min can not be inferior to EEG.times * 1000;\nBaseline max can not be superior to 0;\nBaseline min must be inferior to baseline max.''));'...
                                '    clear EEGtimes Tmin i nfft minB maxB lfreq hfreq resol p range_colorbar limit baseline_limits;'...
                                '    return;'...
                         '    else'...
                             '    fid = fopen(''latest_manual_baseline.txt'',''w'');'...
                             '    fprintf(fid,''%s %s'',''baseline:'',baseline_limits);'...
                             '    fclose(fid);'...
                             '    clear fid ans;'...
                         '    end;'...
                         ... % find the nearest point time of baseline start
                         ... % ---------------------------------------------
                         '    counter_min = inf;'...
                         '    counter_max = inf;'...
                         '    for cha = 1:length(EEG.times)'...
                            '    if EEG.times(cha)<=0 && abs(abs(EEG.times(cha)) - abs(minB)) < counter_min'...
                                '    counter_min = abs(abs(EEG.times(cha)) - abs(minB));'...
                                '    limit_min = cha;'...
                            '    end;'...
                            '    if EEG.times(cha)<=0 && abs(abs(EEG.times(cha)) - abs(maxB)) < counter_max'...
                                '    counter_max = abs(abs(EEG.times(cha)) - abs(maxB));'...
                                '    limit_max = cha;'...
                            '    end;'...
                         '    end;'...
                         '    minB = EEG.times(limit_min);'...
                         '    maxB = EEG.times(limit_max);'...
                         '    clear len_manual_base factor_time;'...
                         ... % build baseline arrays
                         ... % ---------------------
                         '    minb = []; maxb = [];'...
                         '    for gua = 1:length(EEG.epoch)'...
                            '    minb = [minb, minB];'...
                            '    maxb = [maxb, maxB];'...
                         '    end;'....
                         '    clear counter_min counter_max limit_min limit_max cha minB maxB limit baseline_limits limit gua;'...
                         ... % Find index of minb and maxb in EEG.times to build baseline vectors later
                         ... % ------------------------------------------------------------------------
                         '    for cle = 1:length(minb)'...
                            '    MINB(cle) = find(ismember(EEG.times,minb(cle)));'...
                            '    MAXB(cle) = find(ismember(EEG.times,maxb(cle)));'...
                         '    end;'...
                         '    clear cle;'...
                     '    else'...
                         '    errordlg2(''Baseline limits can not be empty. Enter correct limits or unchecked ''''Baseline''''.'');'...
                         '    clear baseline_limits;'...
                         '    return;'...
                     '    end;'...
                 '    end;'...
            'end;'...
            ... % --------------------------------------
            ... % Load units
            ... % --------------------------------------
            '[linecomments colcomments] = size(EEG.comments);'...
            'for s = 1:linecomments'...
                '    unit = {};'...
                '    if strcmp(''Original file: '',EEG.comments(s,1:15));'...
                    '    o = deblank(EEG.comments(s,16:end));'...
                    '    n = [o(1:end-3),''vhdr''];'...
                    '    try'...
                        '    hdrunit = readbvconf(p,n);'...
                        '    for nbchannel = 1:EEG.nbchan'...
                            '    if isfield(hdrunit,''channelinfos'')'...
                                '    [a,b,c,u] = strread(hdrunit.channelinfos{1,nbchannel},''%s%s%s%s'',1,''delimiter'','','');'...
                            '    else'...
                                '    u = ''\muV'';'...
                            '    end;'...
                            '    v = unicode2native(char(u));'...
                            '    if length(v) == 3'... % if it is microvolts 
                                '    unit{nbchannel} = {''\muV''};'...
                            '    else'...
                                '    unit{nbchannel} = u;'...
                            '    end;'...
                        '    end;'...
                    '    catch'...
                        '    for nbchannel = 1:EEG.nbchan'...
                            '    unit{nbchannel} = {''\muV''};'...
                        '    end;'...
                    '    end;'...
                '    else'...
                    '    for nbchannel = 1:EEG.nbchan'...
                        '    unit{nbchannel} = {''\muV''};'...
                    '    end;'...
                '    end;'...
             'end;'...
             'clear p n o hdrunit a b c u v nbchannel s linecomments colcomments;'...
            ... % --------------------------------------
            ... % Recovery of variables
            ... % --------------------------------------
            'evo = get(findobj(''parent'', gcbf, ''tag'', ''evoked''),''value'');'...
            'indu = get(findobj(''parent'', gcbf, ''tag'', ''induced''),''value'');'...
            'significant_line = get(findobj(''parent'', gcbf, ''tag'', ''yes''),''value'');'...
            'if significant_line == 1'...
                '    significant_line = ''yes'';'...
            'else'...
                '    significant_line = ''no'';'...
            'end;'...
            'resulparamclbk(1).valparam = lfreq;'...
            'resulparamclbk(2).valparam = hfreq;'...
            'resulparamclbk(3).valparam = resol;'...
            'clear hfreq lfreq resol;'...
            'listchannel = get(findobj(''parent'', gcbf, ''tag'', ''listchan''),''value'');'...
			'if listchannel(1) == 1'...
				'    errordlg2(''You have to choose 1 or several channels to do the analysis!'');'...
			'end;'...
            'setappdata(0,''listchan'',listchannel);'...
            'EEGnbchan = EEG.nbchan;'...
            'EEGtrials = EEG.trials;'...
            'EEGtimes = EEG.times;'...
            'EEGdata = EEG.data;'...
            'EEGsrate = EEG.srate;'...
            'EEGchaninfo = EEG.chaninfo;'...
            'for i = 1:EEGnbchan'...
                '     EEGchanlocslabels{i} = EEG.chanlocs(i).labels;'...
                '     EEGchanlocs{i} = EEG.chanlocs(i);'...
            'end;'...
            'if get(findobj(''parent'', gcbf, ''tag'', ''select_aux''),''value'') == 1'...
                '    listaux = get(findobj(''parent'', gcbf, ''tag'', ''listaux''),''value'');'...
            'else'...
                '    listaux = 0;'...
            'end;'...
            ... % --------------------------------------
            ... % if 'Plot evoked potentials' is chosen
            ... % --------------------------------------
            'if evo == 1'...
                '    lfreqnorm = str2double(resulparamclbk(1).valparam)/EEG.srate;'...
                '    hfreqnorm = str2double(resulparamclbk(2).valparam)/EEG.srate;'...
                '    resolnorm = str2double(resulparamclbk(3).valparam)/EEG.srate;'...
                '    resulparamclbk(1).valparam = lfreqnorm;'...
                '    resulparamclbk(2).valparam = hfreqnorm;'...
                '    resulparamclbk(3).valparam = resolnorm;'...
                '    setappdata(0,''resulparamclbk'',resulparamclbk);'...
                ...
                '    if BASELINE == 1'...
					'    valueoptbaseline = get(findobj(''parent'', gcbf, ''tag'', ''optbaseline''),''value'');'...
					'    if valueoptbaseline == 1'...
						'    correction_baseline = ''z-score'';'...
					'    elseif valueoptbaseline == 2'...
						'    correction_baseline = ''absolute'';'...
					'    elseif valueoptbaseline == 3'...
						'    correction_baseline = ''relative'';'...
					'    else'...
						'    correction_baseline = ''dB'';'...
					'    end;'...
                    '    if get(findobj(''parent'', gcbf, ''tag'', ''automatic_baseline''),''value'') == 1'...
						'    if showSignif==1'...
							'    signif_level = str2double(signif_level);'...
							'    com = timefrequencyevokedBase( marker_baseline, latency, listauxbase, significant_line, unit, listaux,EEGnbchan, EEGtrials, EEGdata, resulparamclbk, nfft, EEGchanlocslabels, EEGchanlocs, listchannel, range_colorbar, EEGtimes, EEGsrate, EEGchaninfo, len_base, MINB, MAXB, minb, maxb, correction_baseline, signif_level);'...
                        '    else'...
							'    com = timefrequencyevokedBase( marker_baseline, latency, listauxbase, significant_line, unit, listaux,EEGnbchan, EEGtrials, EEGdata, resulparamclbk, nfft, EEGchanlocslabels, EEGchanlocs, listchannel, range_colorbar, EEGtimes, EEGsrate, EEGchaninfo, len_base, MINB, MAXB, minb, maxb, correction_baseline, 0);'...
                        '    end;'...
                    '    else'...
                        '    if showSignif==1'...
							'    signif_level = str2double(signif_level);'...
							'    com = timefrequencyevokedBase( '' '', '' '', '' '', significant_line, unit, listaux,EEGnbchan, EEGtrials, EEGdata, resulparamclbk, nfft, EEGchanlocslabels, EEGchanlocs, listchannel, range_colorbar, EEGtimes, EEGsrate, EEGchaninfo, '' '', MINB, MAXB, minb, maxb, correction_baseline, signif_level);'...
                        '    else'...
							'    com = timefrequencyevokedBase( '' '', '' '', '' '', significant_line, unit, listaux,EEGnbchan, EEGtrials, EEGdata, resulparamclbk, nfft, EEGchanlocslabels, EEGchanlocs, listchannel, range_colorbar, EEGtimes, EEGsrate, EEGchaninfo, '' '', MINB, MAXB, minb, maxb, correction_baseline, 0);'...
                        '    end;'...
                    '    end;'...
                '    else'...
                    '    com = timefrequencyevoked( significant_line,unit,EEGnbchan, EEGtrials, EEGdata, resulparamclbk, nfft, EEGchanlocslabels, EEGchanlocs, listchannel, range_colorbar, EEGtimes, EEGsrate, EEGchaninfo);'...
                '    end;'...
            ... % --------------------------------------
            ... % if 'Plot induced potentials' is chosen
            ... % --------------------------------------
            'else'...
                '    lfreqnorm = str2num(resulparamclbk(1).valparam)/EEG.srate;'...
                '    hfreqnorm = str2num(resulparamclbk(2).valparam)/EEG.srate;'...
                '    resolnorm = str2num(resulparamclbk(3).valparam)/EEG.srate;'...
                '    resulparamclbk(1).valparam = lfreqnorm;'...
                '    resulparamclbk(2).valparam = hfreqnorm;'...
                '    resulparamclbk(3).valparam = resolnorm;'...
                '    setappdata(0,''resulparamclbk'',resulparamclbk);'...
                ...
                '    if BASELINE == 1'...
					'    valueoptbaseline = get(findobj(''parent'', gcbf, ''tag'', ''optbaseline''),''value'');'...
					'    if valueoptbaseline == 1'...
						'    correction_baseline = ''z-score'';'...
					'    elseif valueoptbaseline == 2'...
						'    correction_baseline = ''absolute'';'...
					'    elseif valueoptbaseline == 3'...
						'    correction_baseline = ''relative'';'...
					'    else'...
						'    correction_baseline = ''dB'';'...
					'    end;'...
                    '    if get(findobj(''parent'', gcbf, ''tag'', ''automatic_baseline''),''value'') == 1'...
                        '    if showSignif==1'...
							'    signif_level = str2double(signif_level);'...
                            '    com = timefrequencyinducedBase( marker_baseline, latency, listauxbase, significant_line, unit, listaux,EEGnbchan, EEGtrials, EEGdata, resulparamclbk, nfft, EEGchanlocslabels, EEGchanlocs, listchannel,range_colorbar, EEGtimes, EEGsrate, EEGchaninfo, len_base, MINB, MAXB, minb, maxb, correction_baseline, signif_level);'...
                        '    else'...
                            '    com = timefrequencyinducedBase( marker_baseline, latency, listauxbase, significant_line, unit, listaux,EEGnbchan, EEGtrials, EEGdata, resulparamclbk, nfft, EEGchanlocslabels, EEGchanlocs, listchannel,range_colorbar, EEGtimes, EEGsrate, EEGchaninfo, len_base, MINB, MAXB, minb, maxb, correction_baseline, 0);'...     
                        '    end;'...
                    '    else'...
                        '    if showSignif==1'...
							'    signif_level = str2double(signif_level);'...
                            '    com = timefrequencyinducedBase( '' '', '' '', '' '', significant_line, unit, listaux,EEGnbchan, EEGtrials, EEGdata, resulparamclbk, nfft, EEGchanlocslabels, EEGchanlocs, listchannel,range_colorbar, EEGtimes, EEGsrate, EEGchaninfo, '' '', MINB, MAXB, minb, maxb, correction_baseline, signif_level);'...     
                        '    else'...
                            '    com = timefrequencyinducedBase( '' '', '' '', '' '', significant_line, unit, listaux,EEGnbchan, EEGtrials, EEGdata, resulparamclbk, nfft, EEGchanlocslabels, EEGchanlocs, listchannel,range_colorbar, EEGtimes, EEGsrate, EEGchaninfo, '' '', MINB, MAXB, minb, maxb, correction_baseline, 0);'...     
                        '    end;'...
                    '    end;'...
                '    else'...
                    '    com = timefrequencyinduced( significant_line,unit, EEGnbchan, EEGtrials, EEGdata, resulparamclbk, nfft, EEGchanlocslabels, EEGchanlocs, listchannel, range_colorbar, EEGtimes, EEGsrate, EEGchaninfo);'...
                '    end;'...
            'end;'...
            'close(gcbf);'...
            'clear answer choice_respiratory indice_chan range_colorbar histo_graph event_assoc_minb event_assoc_maxb significant_line listauxbase mark marker_baseline latency listaux unit Tmin resulparamclbk evo indu lfreqnorm hfreqnorm resolnorm listchannel EEGnbchan EEGtrials EEGdata i nfft EEGtimes EEGchanlocslabels EEGchanlocs EEGsrate EEGchaninfo minb maxb MINB MAXB len_base BASELINE correction_baseline;'];

        
        %% Main GUI
        %  --------
        
        icadefs; % read default BACKCOLOR
        COLOR = BACKEEGLABCOLOR;

        W_MAIN = figure('name', 'View and edit potentials -- pop_evokedinduced()',...
            'numbertitle', 'off', ...
            'color', COLOR);
        
        set(0,'Units','normalized')
        scrsz = get(0,'ScreenSize');
        
        uicontrol('parent',W_MAIN,'style','frame','backgroundcolor',COLOR,'units', 'normalized','position',[scrsz(3)/60 scrsz(4)/1.2 scrsz(3)/1.035 scrsz(4)/7.2]);
        a = axes('position',[scrsz(3)/107 scrsz(4)/2.68 scrsz(3)*0.998 scrsz(4)/2.24]);
        rectangle('Position',[scrsz(3)/107 scrsz(4)/2 scrsz(3)*1.162 scrsz(4)/6.45]);
        daspect(a);
        uicontrol('parent',W_MAIN,'style','frame','backgroundcolor',COLOR,'units', 'normalized','position',[scrsz(3)/60 scrsz(4)/16 scrsz(3)/1.035 scrsz(4)/3.58]);
      
        supergui('fig',W_MAIN,'geomhoriz', {[0.18 0.82] [0.5 0.5] [0.5 0.5] [0.5 0.5] [0.3 0.5] [1]     [0.18 0.82] [1] [0.05 0.015 0.015 0.06] [0.05 0.01 0.01 0.07] [0.1 0.075 0.025] [0.04 0.05 0.062 0.023] [0.04 0.05 0.06 0.025] [0.03 0.02 0.07 0.019] [0.03 0.02 0.089] [0.1 0.1 0.1] [0.04 0.02 0.04 0.1] [1] [0.6 0.4] [0.06 0.03 0.04 0.04] [1] [0.06 0.03 0.02 0.05] [1]      [0.18 0.82] [0.5 0.5] [0.5 0.5] [1] [0.5 0.5] [0.5 0.5] [0.47 0.15 0.08 0.08 0.08 0.08] [1] [0.4 0.05 0.05 0.05] [1] [0.2 0.3 0.2 0.2]}, 'geomvert', [1 1 1 1 1 0.8   1 1 1 1 1 1 1 1 1 1 1 0.6 1 1 1 1 1   1 1 3 0.6 1 1 1 0.5 1 1 1], 'uilist', { ...
            ... % 'Parameters'
            { 'Style', 'text', 'string', '      Parameters', 'fontweight', 'bold', 'fontsize',14 ,'fontangle','italic'} {}...
            { 'style', 'text','string', 'Enter the lower frequency in the decomposition (in Hz)', 'fontweight','bold'}...
            { 'style', 'edit', 'tag', 'lower_freq','string',lower_freq}...
            { 'style', 'text','string', 'Enter the higher frequency in the decomposition (in Hz)', 'fontweight','bold'}...
            { 'style', 'edit', 'tag', 'higher_freq','string',higher_freq}...
            { 'style', 'text','string', 'Resolution (in Hz) between 0.25 and 2 Hz', 'fontweight','bold'}...
            { 'style', 'edit', 'tag', 'resolution','string',resolution}...
            { 'style', 'pushbutton', 'string', 'Load other default parameters','callback',param_Callback} {}...
            ...
            {}...
            ... % 'Baseline'
            { 'Style', 'checkbox', 'value', 0, 'string', '      Baseline','fontweight', 'bold', 'fontsize',14 ,'fontangle','italic','callback',clbk_baseline,'tag','baseline'} {}...
            { 'style', 'checkbox', 'value', 0, 'string', 'CHOOSE AN AUTOMATIC BASELINE (dependent on physiological events)','fontweight','bold','tag', 'automatic_baseline','enable','off','callback',clbk_automatic_baseline}...
            { 'Style', 'text', 'string', '1) Select a channel to choose baseline location : ','fontweight', 'bold','tag','text_aux','enable','off'}...
            { 'Style', 'checkbox', 'value', 0, 'string' 'Pressure','tag','pression_base','enable','off','callback',clbk_pression_base} ...
			{ 'Style', 'checkbox', 'value', 0, 'string' 'Cardiac','tag','cardiac_base','enable','off','callback',clbk_cardiac_base} ...
            {'Style', 'text', 'string', 'Stability of markers differences','fontweight', 'bold','tag','tit_hist','enable','off'}... 
            {} { 'Style', 'checkbox', 'value', 0, 'string' 'Flow','tag','flow_base', 'enable','off','callback',clbk_flow_base} {} {}...
            { 'Style', 'text', 'string', 'Where do you want to choose baseline ?','fontweight', 'bold','tag','where','enable','off'} {}...
            {'Style', 'text', 'string', 'Average :','tag','txt_mean_hist','enable','off'}... 
            { 'Style', 'checkbox', 'value', 0, 'string' 'Start of inspiration','tag','beginspi','enable','off','callback',clbk_beginspi}...
            { 'Style', 'checkbox', 'value', 0, 'string' 'Maximum of flow/pressure','tag','peakmax', 'enable','off','callback',clbk_peakmax} {}...
            {'Style', 'text', 'string', ' ','tag','mean_hist','enable','off'}... 
            { 'Style', 'checkbox', 'value', 0, 'string' 'Start of expiration','tag','begexpi', 'enable','off','callback',clbk_begexpi}...
            { 'Style', 'checkbox', 'value', 0, 'string' 'Minimum of flow/pressure','tag','peakmin', 'enable','off','callback',clbk_peakmin} {}...
            {'Style', 'text', 'string', 'Standard dev. :','tag','txt_std_hist','enable','off'}...
            {'Style', 'text', 'string', '2) Baseline position : ','tag','text_latency','fontweight', 'bold','enable','off'}...
            { 'Style', 'checkbox', 'value', 1, 'string' 'Before markers','tag','latneg', 'enable','off','callback',clbk_latneg} {}...
            {'Style', 'text', 'string', ' ','tag','std_hist','enable','off'}...
            {} { 'Style', 'checkbox', 'value', 0, 'string' 'After markers','tag','latpos','enable','off','callback',clbk_latpos} {}...
            {'Style', 'text', 'string', '3) Length of baseline (in ms)','tag','text_len_base','fontweight', 'bold','enable','off'} {} {}...
            {'style', 'edit', 'tag', 'len_base','string','','enable','off'} {}...
            {'Style', 'pushbutton', 'string', 'Check baselines','tag','button_baseline','fontweight', 'bold','fontsize',12 ,'enable','off','callback',clbk_buttonbase} {} ...
            {} { 'style','checkbox', 'string','CHOOSE A MANUAL BASELINE (independent on physiological events)','value',0,'fontweight','bold','tag','manual_baseline','enable','off','callback',clbk_manual_baseline} {}...
			{'style','text','string','Baseline limits (in ms) : min max (e.g. -1200.5 -900)','tag','text_baseline_limits','enable','off'}...
            {'style','edit','string',' ','tag','baseline_limits','enable','off'} {}...
            {'style' 'popupmenu',  'string', show_options_baseline 'tag' 'optbaseline','enable','off'}...
            {} { 'Style', 'checkbox', 'value', 0, 'string' 'Show significant points with respect to the baseline','tag','showSignif','enable','off','callback',clbk_showSignif}...
            {'Style', 'text', 'string', 'Significance level: ','tag','text_signif_level','enable','off'}...
            {'style', 'edit', 'tag', 'signif_level','string','0.05','enable','off'}...
            {}...
            ...
            {}...
            ...% 'Plot'
            { 'Style', 'text', 'string', '      Plot','fontweight', 'bold', 'fontsize',14 ,'fontangle','italic'} {}...
            { 'Style', 'text', 'string', 'Select channel(s) to plot', 'fontweight', 'bold'  }...
            { 'Style', 'checkbox','value', 0, 'string', 'Select a channel to monitor baseline location', 'tag','select_aux','fontweight', 'bold','callback',clbk_select_aux, 'enable','off' }...
            {'style' 'listbox'  ,  'string', show_options  'max' 10 'tag' 'listchan'} ...
            {'style' 'listbox'  ,  'string', show_aux  'max' 1 'tag' 'listaux','enable','off'} ...
            {}...
            { 'Style', 'checkbox', 'value', 1, 'string' 'Plot evoked potentials (time-frequency map of epochs average)','tag','evoked', 'fontweight', 'bold','callback',clbk_evo} ...
            { 'style','text','string','Choose the colorbar range :','fontweight','bold'}...
            { 'Style', 'checkbox', 'value', 0, 'string' 'Plot induced potentials (average of time-frequency maps)','tag','induced', 'fontweight', 'bold','callback',clbk_indu} ...
            { 'style','checkbox','string','Automatic range (min and max of the time-frequency map)','value',1,'tag','autocolorbar','callback',clbk_autocolorbar}...
            {} { 'style','checkbox','string','Manual range','tag','manualcolorbar','value',0,'callback',clbk_manualcolorbar}...
            { 'style','text','string','min :','tag','text_mincolorbar','enable','off'}...
            { 'style','edit','string',' ','tag','mincolorbar','enable','off'}...
            { 'style','text','string','max :','tag','text_maxcolorbar','enable','off'}...
            { 'style','edit','string',' ','tag','maxcolorbar','enable','off'}...
            {}...
            { 'Style', 'text', 'string', 'Do you want to overlay the cone of influence on the map?', 'fontweight', 'bold' }...
            { 'Style', 'radio', 'string', '  Yes','value', 1, 'tag', 'yes','callback', clbk_yes }...
            { 'Style', 'radio', 'string', '  No','value', 0 ,'tag', 'no','callback', clbk_no} {}...
            {}...
            { 'style', 'pushbutton' , 'string', 'Help' 'callback' 'pophelp(''pop_evokedinduced'');' }...
            {} { 'style', 'pushbutton' , 'string', 'Cancel' 'callback' 'close(gcbf); clear lfreq hfreq resol kl counter is kal length_written ligne latency cot any_epoch base_any_epoch peakmin peakmax beginspi begexpi aux_raw indice_chan p event_assoc_minb event_assoc_maxb histo_graph ACCEPTBASELINE significant_line listauxbase mark marker_baseline latency listaux unit Tmin resulparamclbk evo indu lfreqnorm hfreqnorm resolnorm listchannel EEGnbchan EEGtrials EEGdata i nfft EEGtimes EEGchanlocslabels EEGchanlocs EEGsrate EEGchaninfo minb maxb len_base BASELINE;'}...
            { 'style', 'pushbutton' , 'string', 'OK','fontweight', 'bold','callback',ok_clbk}});
		set(W_MAIN,'WindowStyle','modal');
    end;
end;


return;

